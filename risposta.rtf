{\rtf1\ansi\ansicpg1252\cocoartf2709
\cocoatextscaling0\cocoaplatform0{\fonttbl\f0\froman\fcharset0 Times-Roman;\f1\froman\fcharset0 Times-Bold;\f2\fmodern\fcharset0 Courier;
\f3\fnil\fcharset0 .AppleSystemUIFontMonospaced-Regular;\f4\fnil\fcharset0 .AppleSystemUIFontMonospaced-RegularItalic;}
{\colortbl;\red255\green255\blue255;\red0\green0\blue0;\red147\green0\blue147;\red255\green255\blue255;
\red42\green44\blue51;\red143\green144\blue150;\red50\green94\blue238;\red66\green147\blue62;\red167\green87\blue5;
}
{\*\expandedcolortbl;;\cssrgb\c0\c0\c0;\cssrgb\c65098\c14902\c64314;\cssrgb\c100000\c100000\c100000;
\cssrgb\c21961\c22745\c25882;\cssrgb\c62745\c63137\c65490;\cssrgb\c25098\c47059\c94902;\cssrgb\c31373\c63137\c30980;\cssrgb\c71765\c41961\c392;
}
{\*\listtable{\list\listtemplateid1\listhybrid{\listlevel\levelnfc0\levelnfcn0\leveljc0\leveljcn0\levelfollow0\levelstartat1\levelspace360\levelindent0{\*\levelmarker \{decimal\}}{\leveltext\leveltemplateid1\'01\'00;}{\levelnumbers\'01;}\fi-360\li720\lin720 }{\listname ;}\listid1}
{\list\listtemplateid2\listhybrid{\listlevel\levelnfc23\levelnfcn23\leveljc0\leveljcn0\levelfollow0\levelstartat1\levelspace360\levelindent0{\*\levelmarker \{disc\}}{\leveltext\leveltemplateid101\'01\uc0\u8226 ;}{\levelnumbers;}\fi-360\li720\lin720 }{\listname ;}\listid2}
{\list\listtemplateid3\listhybrid{\listlevel\levelnfc23\levelnfcn23\leveljc0\leveljcn0\levelfollow0\levelstartat1\levelspace360\levelindent0{\*\levelmarker \{disc\}}{\leveltext\leveltemplateid201\'01\uc0\u8226 ;}{\levelnumbers;}\fi-360\li720\lin720 }{\listname ;}\listid3}
{\list\listtemplateid4\listhybrid{\listlevel\levelnfc23\levelnfcn23\leveljc0\leveljcn0\levelfollow0\levelstartat1\levelspace360\levelindent0{\*\levelmarker \{disc\}}{\leveltext\leveltemplateid301\'01\uc0\u8226 ;}{\levelnumbers;}\fi-360\li720\lin720 }{\listname ;}\listid4}
{\list\listtemplateid5\listhybrid{\listlevel\levelnfc23\levelnfcn23\leveljc0\leveljcn0\levelfollow0\levelstartat1\levelspace360\levelindent0{\*\levelmarker \{disc\}}{\leveltext\leveltemplateid401\'01\uc0\u8226 ;}{\levelnumbers;}\fi-360\li720\lin720 }{\listname ;}\listid5}
{\list\listtemplateid6\listhybrid{\listlevel\levelnfc23\levelnfcn23\leveljc0\leveljcn0\levelfollow0\levelstartat1\levelspace360\levelindent0{\*\levelmarker \{disc\}}{\leveltext\leveltemplateid501\'01\uc0\u8226 ;}{\levelnumbers;}\fi-360\li720\lin720 }{\listname ;}\listid6}
{\list\listtemplateid7\listhybrid{\listlevel\levelnfc23\levelnfcn23\leveljc0\leveljcn0\levelfollow0\levelstartat1\levelspace360\levelindent0{\*\levelmarker \{disc\}}{\leveltext\leveltemplateid601\'01\uc0\u8226 ;}{\levelnumbers;}\fi-360\li720\lin720 }{\listname ;}\listid7}
{\list\listtemplateid8\listhybrid{\listlevel\levelnfc23\levelnfcn23\leveljc0\leveljcn0\levelfollow0\levelstartat1\levelspace360\levelindent0{\*\levelmarker \{disc\}}{\leveltext\leveltemplateid701\'01\uc0\u8226 ;}{\levelnumbers;}\fi-360\li720\lin720 }{\listname ;}\listid8}
{\list\listtemplateid9\listhybrid{\listlevel\levelnfc23\levelnfcn23\leveljc0\leveljcn0\levelfollow0\levelstartat1\levelspace360\levelindent0{\*\levelmarker \{disc\}}{\leveltext\leveltemplateid801\'01\uc0\u8226 ;}{\levelnumbers;}\fi-360\li720\lin720 }{\listname ;}\listid9}
{\list\listtemplateid10\listhybrid{\listlevel\levelnfc23\levelnfcn23\leveljc0\leveljcn0\levelfollow0\levelstartat1\levelspace360\levelindent0{\*\levelmarker \{disc\}}{\leveltext\leveltemplateid901\'01\uc0\u8226 ;}{\levelnumbers;}\fi-360\li720\lin720 }{\listname ;}\listid10}
{\list\listtemplateid11\listhybrid{\listlevel\levelnfc23\levelnfcn23\leveljc0\leveljcn0\levelfollow0\levelstartat1\levelspace360\levelindent0{\*\levelmarker \{disc\}}{\leveltext\leveltemplateid1001\'01\uc0\u8226 ;}{\levelnumbers;}\fi-360\li720\lin720 }{\listname ;}\listid11}}
{\*\listoverridetable{\listoverride\listid1\listoverridecount0\ls1}{\listoverride\listid2\listoverridecount0\ls2}{\listoverride\listid3\listoverridecount0\ls3}{\listoverride\listid4\listoverridecount0\ls4}{\listoverride\listid5\listoverridecount0\ls5}{\listoverride\listid6\listoverridecount0\ls6}{\listoverride\listid7\listoverridecount0\ls7}{\listoverride\listid8\listoverridecount0\ls8}{\listoverride\listid9\listoverridecount0\ls9}{\listoverride\listid10\listoverridecount0\ls10}{\listoverride\listid11\listoverridecount0\ls11}}
\paperw11900\paperh16840\margl1440\margr1440\vieww11520\viewh8400\viewkind0
\deftab720
\pard\pardeftab720\sa240\partightenfactor0

\f0\fs24 \cf0 \expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 Analizzer\'f2 il tuo codice e ti proporr\'f2 miglioramenti sostanziali da prospettive multiple: marketing musicale, analisi dati e sviluppo AI.\
\pard\pardeftab720\sa298\partightenfactor0

\f1\b\fs36 \cf0 Problemi Critici Identificati\
\pard\tx220\tx720\pardeftab720\li720\fi-720\partightenfactor0
\ls1\ilvl0
\fs24 \cf0 \kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	1	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 Chat senza contesto strategico
\f0\b0  - L'AI non ha accesso ai dati delle campagne\
\ls1\ilvl0
\f1\b \kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	2	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 Database non relazionale
\f0\b0  - Manca collegamento tra chat, campagne e insights\
\ls1\ilvl0
\f1\b \kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	3	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 Nessuna analisi predittiva
\f0\b0  - Solo storage, zero intelligence\
\ls1\ilvl0
\f1\b \kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	4	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 UI generica
\f0\b0  - Non rispecchia il workflow di un music marketer\
\ls1\ilvl0
\f1\b \kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	5	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 Mancanza di KPI musicali specifici
\f0\b0  - Streams, engagement rate, virality score\
\pard\pardeftab720\sa298\partightenfactor0

\f1\b\fs36 \cf0 Soluzione: Sistema Integrato Intelligente## \uc0\u55356 \u57263  Miglioramenti Implementati\
\pard\pardeftab720\sa280\partightenfactor0

\fs28 \cf0 1. ANALYTICS AVANZATE\
\pard\tx220\tx720\pardeftab720\li720\fi-720\partightenfactor0
\ls2\ilvl0
\fs24 \cf0 \kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	\uc0\u8226 	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 KPI Musicali Specifici
\f0\b0 : Streams, Saves, Shares, CTR\
\ls2\ilvl0
\f1\b \kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	\uc0\u8226 	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 Metriche Composite
\f0\b0 : Efficiency Score, Trend Analysis\
\ls2\ilvl0
\f1\b \kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	\uc0\u8226 	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 Grafici Interattivi
\f0\b0 : Performance Matrix con bolle dimensionate per streams\
\pard\pardeftab720\sa280\partightenfactor0

\f1\b\fs28 \cf0 2. AI CON CONTESTO REAL-TIME\
\pard\tx220\tx720\pardeftab720\li720\fi-720\partightenfactor0
\ls3\ilvl0
\f0\b0\fs24 \cf0 \kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	\uc0\u8226 	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 L'AI ora 
\f1\b vede tutti i dati delle campagne
\f0\b0  in tempo reale\
\ls3\ilvl0\kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	\uc0\u8226 	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 Sistema prompt dinamico che inietta numeri specifici\
\ls3\ilvl0\kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	\uc0\u8226 	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 Risposte basate su 
\f1\b pattern reali
\f0\b0  (es: "Meta funziona meglio perch\'e9...")\
\ls3\ilvl0\kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	\uc0\u8226 	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 Salvata correlazione chat \uc0\u8596  campagne nel DB\
\pard\pardeftab720\sa280\partightenfactor0

\f1\b\fs28 \cf0 3. DATABASE RELAZIONALE\
\pard\tx220\tx720\pardeftab720\li720\fi-720\partightenfactor0
\ls4\ilvl0
\f0\b0\fs24 \cf0 \kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	\uc0\u8226 	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 4 tabelle interconnesse\
\ls4\ilvl0\kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	\uc0\u8226 	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 Tracciamento sessioni chat\
\ls4\ilvl0\kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	\uc0\u8226 	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 Storico insights AI con confidence score\
\ls4\ilvl0\kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	\uc0\u8226 	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 Artist profile per benchmarking\
\pard\pardeftab720\sa280\partightenfactor0

\f1\b\fs28 \cf0 4. UX OTTIMIZZATA PER MUSIC MARKETING\
\pard\tx220\tx720\pardeftab720\li720\fi-720\partightenfactor0
\ls5\ilvl0
\f0\b0\fs24 \cf0 \kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	\uc0\u8226 	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 Form completo con targeting e creative type\
\ls5\ilvl0\kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	\uc0\u8226 	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 Visualizzazione campagne con expander dettagliati\
\ls5\ilvl0\kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	\uc0\u8226 	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 Eliminazione campagne con conferma\
\ls5\ilvl0\kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	\uc0\u8226 	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 Metriche visibili in sidebar durante navigazione\
\pard\pardeftab720\sa280\partightenfactor0

\f1\b\fs28 \cf0 5. SISTEMA DI INSIGHTS\
\pard\tx220\tx720\pardeftab720\li720\fi-720\partightenfactor0
\ls6\ilvl0
\f0\b0\fs24 \cf0 \kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	\uc0\u8226 	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 Tabella 
\f2\fs26 ai_insights
\f0\fs24  per salvare pattern identificati\
\ls6\ilvl0\kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	\uc0\u8226 	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 Base per futuro sistema di raccomandazioni automatiche\
\pard\pardeftab720\partightenfactor0
\cf0 \
\pard\pardeftab720\sa298\partightenfactor0

\f1\b\fs36 \cf0 API Integrate\
\pard\pardeftab720\sa280\partightenfactor0

\fs28 \cf0 \uc0\u55356 \u57269  Spotify for Artists\
\pard\tx220\tx720\pardeftab720\li720\fi-720\partightenfactor0
\ls7\ilvl0
\f0\b0\fs24 \cf0 \kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	\uc0\u8226 	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 Followers, Popularity Score, Top Tracks\
\ls7\ilvl0\kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	\uc0\u8226 	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 OAuth 2.0 completo\
\ls7\ilvl0\kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	\uc0\u8226 	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 Salvataggio automatico storico\
\pard\pardeftab720\sa280\partightenfactor0

\f1\b\fs28 \cf0 \strokec2 \uc0\u55357 \u56568  Instagram Business\
\pard\tx220\tx720\pardeftab720\li720\fi-720\partightenfactor0
\ls8\ilvl0
\f0\b0\fs24 \cf0 \kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	\uc0\u8226 	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 Followers, Media Count, Engagement Rate\
\ls8\ilvl0\kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	\uc0\u8226 	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 Analisi ultimi post (likes, commenti)\
\ls8\ilvl0\kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	\uc0\u8226 	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 Richiede Facebook Graph API\
\pard\pardeftab720\sa280\partightenfactor0

\f1\b\fs28 \cf0 \strokec2 \uc0\u9654 \u65039  YouTube Data API v3\
\pard\tx220\tx720\pardeftab720\li720\fi-720\partightenfactor0
\ls9\ilvl0
\f0\b0\fs24 \cf0 \kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	\uc0\u8226 	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 Iscritti, Views totali, Video count\
\ls9\ilvl0\kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	\uc0\u8226 	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 Statistiche singoli video\
\ls9\ilvl0\kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	\uc0\u8226 	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 Tracking performance nel tempo\
\pard\pardeftab720\sa280\partightenfactor0

\f1\b\fs28 \cf0 \strokec2 \uc0\u55356 \u57260  TikTok\
\pard\tx220\tx720\pardeftab720\li720\fi-720\partightenfactor0
\ls10\ilvl0
\f0\b0\fs24 \cf0 \kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	\uc0\u8226 	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 Import manuale (API ufficiale limitata)\
\ls10\ilvl0\kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	\uc0\u8226 	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 Salvataggio metriche: followers, likes, engagement rate\
\ls10\ilvl0\kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	\uc0\u8226 	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 Storico dati\
\pard\pardeftab720\partightenfactor0
\cf0 \strokec2 \
\pard\pardeftab720\sa298\partightenfactor0

\f1\b\fs36 \cf0 \uc0\u55357 \u56507  Funzioner\'e0 su MacBook Pro pre-2018?\
\pard\pardeftab720\sa280\partightenfactor0

\fs28 \cf0 \uc0\u9989  S\'cc, con alcune precisazioni:\
\pard\pardeftab720\sa240\partightenfactor0

\fs24 \cf0 \strokec2 Requisiti minimi:
\f0\b0 \strokec2 \
\pard\tx220\tx720\pardeftab720\li720\fi-720\partightenfactor0
\ls11\ilvl0
\f1\b \cf0 \kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	\uc0\u8226 	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 macOS 10.13+
\f0\b0  (High Sierra o superiore)\
\ls11\ilvl0
\f1\b \kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	\uc0\u8226 	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 8GB RAM
\f0\b0  (16GB raccomandati per Ollama)\
\ls11\ilvl0
\f1\b \kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	\uc0\u8226 	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 Python 3.8+
\f0\b0  (hai 3.12, perfetto)\
\ls11\ilvl0
\f1\b \kerning1\expnd0\expndtw0 \outl0\strokewidth0 {\listtext	\uc0\u8226 	}\expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 10GB spazio libero
\f0\b0  per modelli Ollama\
\pard\pardeftab720\sa298\partightenfactor0
\cf0 \strokec2 \
\
\
\pard\pardeftab720\partightenfactor0

\f3\fs28 \cf3 \cb4 \strokec3 import\cf5 \strokec5  streamlit \cf3 \strokec3 as\cf5 \strokec5  st\
\cf3 \strokec3 import\cf5 \strokec5  ollama\
\cf3 \strokec3 import\cf5 \strokec5  pandas \cf3 \strokec3 as\cf5 \strokec5  pd\
\cf3 \strokec3 import\cf5 \strokec5  sqlite3\
\cf3 \strokec3 import\cf5 \strokec5  plotly.express \cf3 \strokec3 as\cf5 \strokec5  px\
\cf3 \strokec3 import\cf5 \strokec5  plotly.graph_objects \cf3 \strokec3 as\cf5 \strokec5  go\
\cf3 \strokec3 from\cf5 \strokec5  datetime \cf3 \strokec3 import\cf5 \strokec5  datetime, timedelta\
\cf3 \strokec3 import\cf5 \strokec5  json\
\cf3 \strokec3 import\cf5 \strokec5  requests\
\cf3 \strokec3 from\cf5 \strokec5  urllib.parse \cf3 \strokec3 import\cf5 \strokec5  urlencode\
\cf3 \strokec3 import\cf5 \strokec5  base64\
\
\pard\pardeftab720\partightenfactor0

\f4\i \cf6 \strokec6 # --- CONFIGURAZIONE ---
\f3\i0 \cf5 \strokec5 \
st.set_page_config(page_title\cf7 \strokec7 =\cf8 \strokec8 "YANGKIDD ENTERPRISE AI"\cf5 \strokec5 , page_icon\cf7 \strokec7 =\cf8 \strokec8 "\uc0\u55357 \u56462 "\cf5 \strokec5 , layout\cf7 \strokec7 =\cf8 \strokec8 "wide"\cf5 \strokec5 )\
\

\f4\i \cf6 \strokec6 # --- STILE CYBERPUNK PREMIUM ---
\f3\i0 \cf5 \strokec5 \
st.markdown(\cf8 \strokec8 """\
\pard\pardeftab720\partightenfactor0
\cf5 \strokec5 <style>\
    .stApp \{ background: linear-gradient(135deg, #0a0a0a 0%, #1a0a1a 100%); color: #e0e0e0; \}\
    .stTextInput > div > div > input \{ background-color: #1a1a1a; color: #00ff99; border: 2px solid #333; \}\
    .stChatMessage \{ background: rgba(26, 26, 26, 0.8); border-left: 3px solid #00ff99; \}\
    h1 \{ color: #00ff99; text-shadow: 0 0 20px rgba(0, 255, 153, 0.5); \}\
    .metric-card \{ background: #1a1a1a; padding: 20px; border-radius: 10px; border: 1px solid #333; \}\
    .insight-box \{ background: linear-gradient(135deg, #1a1a1a 0%, #2a1a2a 100%); \
                    padding: 15px; border-radius: 8px; border-left: 4px solid #ff00ff; margin: 10px 0; \}\
</style>\
\pard\pardeftab720\partightenfactor0
\cf8 \strokec8 """\cf5 \strokec5 , unsafe_allow_html\cf7 \strokec7 =\cf9 \strokec9 True\cf5 \strokec5 )\
\
\pard\pardeftab720\partightenfactor0

\f4\i \cf6 \strokec6 # --- DATABASE AVANZATO ---
\f3\i0 \cf5 \strokec5 \
\pard\pardeftab720\partightenfactor0
\cf3 \strokec3 def\cf5 \strokec5  \cf7 \strokec7 init_advanced_db\cf5 \strokec5 ():\
    conn \cf7 \strokec7 =\cf5 \strokec5  sqlite3.connect(\cf8 \strokec8 'yangkidd_pro.db'\cf5 \strokec5 )\
    c \cf7 \strokec7 =\cf5 \strokec5  conn.cursor()\
    \
    
\f4\i \cf6 \strokec6 # Tabella Campagne (espansa)
\f3\i0 \cf5 \strokec5 \
    c.execute(\cf8 \strokec8 '''CREATE TABLE IF NOT EXISTS campaigns\
\pard\pardeftab720\partightenfactor0
\cf5 \strokec5                  (id INTEGER PRIMARY KEY AUTOINCREMENT,\
                  name TEXT, platform TEXT, status TEXT,\
                  budget REAL, spend REAL, revenue REAL, roas REAL,\
                  impressions INTEGER, clicks INTEGER, ctr REAL,\
                  streams INTEGER, saves INTEGER, shares INTEGER,\
                  target_audience TEXT, creative_type TEXT,\
                  start_date TEXT, end_date TEXT,\
\pard\pardeftab720\partightenfactor0
\cf8 \strokec8                   notes TEXT)'''\cf5 \strokec5 )\
    \
    
\f4\i \cf6 \strokec6 # Tabella Chat con Context
\f3\i0 \cf5 \strokec5 \
    c.execute(\cf8 \strokec8 '''CREATE TABLE IF NOT EXISTS chat_history\
\pard\pardeftab720\partightenfactor0
\cf5 \strokec5                  (id INTEGER PRIMARY KEY AUTOINCREMENT,\
                  session_id TEXT, role TEXT, content TEXT,\
\pard\pardeftab720\partightenfactor0
\cf8 \strokec8                   campaign_context TEXT, timestamp DATETIME DEFAULT CURRENT_TIMESTAMP)'''\cf5 \strokec5 )\
    \
    
\f4\i \cf6 \strokec6 # Tabella Insights AI
\f3\i0 \cf5 \strokec5 \
    c.execute(\cf8 \strokec8 '''CREATE TABLE IF NOT EXISTS ai_insights\
\pard\pardeftab720\partightenfactor0
\cf5 \strokec5                  (id INTEGER PRIMARY KEY AUTOINCREMENT,\
                  insight_type TEXT, content TEXT, confidence REAL,\
\pard\pardeftab720\partightenfactor0
\cf8 \strokec8                   related_campaigns TEXT, timestamp DATETIME DEFAULT CURRENT_TIMESTAMP)'''\cf5 \strokec5 )\
    \
    
\f4\i \cf6 \strokec6 # Tabella Artist Profile
\f3\i0 \cf5 \strokec5 \
    c.execute(\cf8 \strokec8 '''CREATE TABLE IF NOT EXISTS artist_profile\
\pard\pardeftab720\partightenfactor0
\cf5 \strokec5                  (id INTEGER PRIMARY KEY AUTOINCREMENT,\
                  platform TEXT, followers INTEGER, monthly_listeners INTEGER,\
                  avg_engagement_rate REAL, top_demographic TEXT,\
\pard\pardeftab720\partightenfactor0
\cf8 \strokec8                   last_updated TEXT)'''\cf5 \strokec5 )\
    \
    
\f4\i \cf6 \strokec6 # Tabella API Credentials
\f3\i0 \cf5 \strokec5 \
    c.execute(\cf8 \strokec8 '''CREATE TABLE IF NOT EXISTS api_credentials\
\pard\pardeftab720\partightenfactor0
\cf5 \strokec5                  (id INTEGER PRIMARY KEY AUTOINCREMENT,\
                  platform TEXT UNIQUE, client_id TEXT, client_secret TEXT,\
\pard\pardeftab720\partightenfactor0
\cf8 \strokec8                   access_token TEXT, refresh_token TEXT, expires_at TEXT)'''\cf5 \strokec5 )\
    \
    
\f4\i \cf6 \strokec6 # Tabella Platform Stats (storage dati API)
\f3\i0 \cf5 \strokec5 \
    c.execute(\cf8 \strokec8 '''CREATE TABLE IF NOT EXISTS platform_stats\
\pard\pardeftab720\partightenfactor0
\cf5 \strokec5                  (id INTEGER PRIMARY KEY AUTOINCREMENT,\
                  platform TEXT, metric_name TEXT, metric_value REAL,\
\pard\pardeftab720\partightenfactor0
\cf8 \strokec8                   date TEXT, raw_data TEXT)'''\cf5 \strokec5 )\
    \
    conn.commit()\
    conn.close()\
\
init_advanced_db()\
\
\pard\pardeftab720\partightenfactor0

\f4\i \cf6 \strokec6 # --- FUNZIONI DATABASE ---
\f3\i0 \cf5 \strokec5 \
\pard\pardeftab720\partightenfactor0
\cf3 \strokec3 def\cf5 \strokec5  \cf7 \strokec7 save_campaign\cf5 \strokec5 (data):\
    conn \cf7 \strokec7 =\cf5 \strokec5  sqlite3.connect(\cf8 \strokec8 'yangkidd_pro.db'\cf5 \strokec5 )\
    c \cf7 \strokec7 =\cf5 \strokec5  conn.cursor()\
    data[\cf8 \strokec8 'roas'\cf5 \strokec5 ] \cf7 \strokec7 =\cf5 \strokec5  data[\cf8 \strokec8 'revenue'\cf5 \strokec5 ] \cf7 \strokec7 /\cf5 \strokec5  data[\cf8 \strokec8 'spend'\cf5 \strokec5 ] \cf3 \strokec3 if\cf5 \strokec5  data[\cf8 \strokec8 'spend'\cf5 \strokec5 ] \cf7 \strokec7 >\cf5 \strokec5  \cf9 \strokec9 0\cf5 \strokec5  \cf3 \strokec3 else\cf5 \strokec5  \cf9 \strokec9 0\cf5 \strokec5 \
    data[\cf8 \strokec8 'ctr'\cf5 \strokec5 ] \cf7 \strokec7 =\cf5 \strokec5  (data[\cf8 \strokec8 'clicks'\cf5 \strokec5 ] \cf7 \strokec7 /\cf5 \strokec5  data[\cf8 \strokec8 'impressions'\cf5 \strokec5 ] \cf7 \strokec7 *\cf5 \strokec5  \cf9 \strokec9 100\cf5 \strokec5 ) \cf3 \strokec3 if\cf5 \strokec5  data[\cf8 \strokec8 'impressions'\cf5 \strokec5 ] \cf7 \strokec7 >\cf5 \strokec5  \cf9 \strokec9 0\cf5 \strokec5  \cf3 \strokec3 else\cf5 \strokec5  \cf9 \strokec9 0\cf5 \strokec5 \
    \
    c.execute(\cf8 \strokec8 """INSERT INTO campaigns \
\pard\pardeftab720\partightenfactor0
\cf5 \strokec5                  (name, platform, status, budget, spend, revenue, roas, impressions, clicks, ctr,\
                  streams, saves, shares, target_audience, creative_type, start_date, end_date, notes)\
\pard\pardeftab720\partightenfactor0
\cf8 \strokec8                  VALUES (?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?)"""\cf5 \strokec5 ,\
              (data[\cf8 \strokec8 'name'\cf5 \strokec5 ], data[\cf8 \strokec8 'platform'\cf5 \strokec5 ], data[\cf8 \strokec8 'status'\cf5 \strokec5 ], data[\cf8 \strokec8 'budget'\cf5 \strokec5 ], data[\cf8 \strokec8 'spend'\cf5 \strokec5 ], \
               data[\cf8 \strokec8 'revenue'\cf5 \strokec5 ], data[\cf8 \strokec8 'roas'\cf5 \strokec5 ], data[\cf8 \strokec8 'impressions'\cf5 \strokec5 ], data[\cf8 \strokec8 'clicks'\cf5 \strokec5 ], data[\cf8 \strokec8 'ctr'\cf5 \strokec5 ],\
               data[\cf8 \strokec8 'streams'\cf5 \strokec5 ], data[\cf8 \strokec8 'saves'\cf5 \strokec5 ], data[\cf8 \strokec8 'shares'\cf5 \strokec5 ], data[\cf8 \strokec8 'target_audience'\cf5 \strokec5 ], \
               data[\cf8 \strokec8 'creative_type'\cf5 \strokec5 ], data[\cf8 \strokec8 'start_date'\cf5 \strokec5 ], data[\cf8 \strokec8 'end_date'\cf5 \strokec5 ], data[\cf8 \strokec8 'notes'\cf5 \strokec5 ]))\
    conn.commit()\
    conn.close()\
\
\pard\pardeftab720\partightenfactor0
\cf3 \strokec3 def\cf5 \strokec5  \cf7 \strokec7 get_campaigns\cf5 \strokec5 ():\
    conn \cf7 \strokec7 =\cf5 \strokec5  sqlite3.connect(\cf8 \strokec8 'yangkidd_pro.db'\cf5 \strokec5 )\
    df \cf7 \strokec7 =\cf5 \strokec5  pd.read_sql_query(\cf8 \strokec8 "SELECT * FROM campaigns ORDER BY id DESC"\cf5 \strokec5 , conn)\
    conn.close()\
    \cf3 \strokec3 return\cf5 \strokec5  df\
\
\cf3 \strokec3 def\cf5 \strokec5  \cf7 \strokec7 delete_campaign\cf5 \strokec5 (campaign_id):\
    conn \cf7 \strokec7 =\cf5 \strokec5  sqlite3.connect(\cf8 \strokec8 'yangkidd_pro.db'\cf5 \strokec5 )\
    c \cf7 \strokec7 =\cf5 \strokec5  conn.cursor()\
    c.execute(\cf8 \strokec8 "DELETE FROM campaigns WHERE id=?"\cf5 \strokec5 , (campaign_id,))\
    conn.commit()\
    conn.close()\
\
\cf3 \strokec3 def\cf5 \strokec5  \cf7 \strokec7 save_chat_message\cf5 \strokec5 (role, content, campaign_context\cf7 \strokec7 =\cf9 \strokec9 None\cf5 \strokec5 ):\
    conn \cf7 \strokec7 =\cf5 \strokec5  sqlite3.connect(\cf8 \strokec8 'yangkidd_pro.db'\cf5 \strokec5 )\
    c \cf7 \strokec7 =\cf5 \strokec5  conn.cursor()\
    session_id \cf7 \strokec7 =\cf5 \strokec5  st.session_state.get(\cf8 \strokec8 'session_id'\cf5 \strokec5 , \cf8 \strokec8 'default'\cf5 \strokec5 )\
    c.execute(\cf8 \strokec8 "INSERT INTO chat_history (session_id, role, content, campaign_context) VALUES (?,?,?,?)"\cf5 \strokec5 ,\
              (session_id, role, content, json.dumps(campaign_context) \cf3 \strokec3 if\cf5 \strokec5  campaign_context \cf3 \strokec3 else\cf5 \strokec5  \cf9 \strokec9 None\cf5 \strokec5 ))\
    conn.commit()\
    conn.close()\
\
\cf3 \strokec3 def\cf5 \strokec5  \cf7 \strokec7 load_chat_history\cf5 \strokec5 ():\
    conn \cf7 \strokec7 =\cf5 \strokec5  sqlite3.connect(\cf8 \strokec8 'yangkidd_pro.db'\cf5 \strokec5 )\
    session_id \cf7 \strokec7 =\cf5 \strokec5  st.session_state.get(\cf8 \strokec8 'session_id'\cf5 \strokec5 , \cf8 \strokec8 'default'\cf5 \strokec5 )\
    cursor \cf7 \strokec7 =\cf5 \strokec5  conn.cursor()\
    cursor.execute(\cf8 \strokec8 "SELECT role, content FROM chat_history WHERE session_id=? ORDER BY id ASC LIMIT 50"\cf5 \strokec5 , (session_id,))\
    rows \cf7 \strokec7 =\cf5 \strokec5  cursor.fetchall()\
    conn.close()\
    \cf3 \strokec3 return\cf5 \strokec5  [\{\cf8 \strokec8 "role"\cf5 \strokec5 : row[\cf9 \strokec9 0\cf5 \strokec5 ], \cf8 \strokec8 "content"\cf5 \strokec5 : row[\cf9 \strokec9 1\cf5 \strokec5 ]\} \cf3 \strokec3 for\cf5 \strokec5  row \cf3 \strokec3 in\cf5 \strokec5  rows]\
\
\cf3 \strokec3 def\cf5 \strokec5  \cf7 \strokec7 save_ai_insight\cf5 \strokec5 (insight_type, content, confidence, related_campaigns\cf7 \strokec7 =\cf9 \strokec9 None\cf5 \strokec5 ):\
    conn \cf7 \strokec7 =\cf5 \strokec5  sqlite3.connect(\cf8 \strokec8 'yangkidd_pro.db'\cf5 \strokec5 )\
    c \cf7 \strokec7 =\cf5 \strokec5  conn.cursor()\
    c.execute(\cf8 \strokec8 "INSERT INTO ai_insights (insight_type, content, confidence, related_campaigns) VALUES (?,?,?,?)"\cf5 \strokec5 ,\
              (insight_type, content, confidence, json.dumps(related_campaigns) \cf3 \strokec3 if\cf5 \strokec5  related_campaigns \cf3 \strokec3 else\cf5 \strokec5  \cf9 \strokec9 None\cf5 \strokec5 ))\
    conn.commit()\
    conn.close()\
\
\pard\pardeftab720\partightenfactor0

\f4\i \cf6 \strokec6 # --- API INTEGRATIONS ---
\f3\i0 \cf5 \strokec5 \
\
\pard\pardeftab720\partightenfactor0
\cf3 \strokec3 class\cf5 \strokec5  \cf9 \strokec9 SpotifyAPI\cf5 \strokec5 :\
    \cf8 \strokec8 """Spotify for Artists API Integration"""\cf5 \strokec5 \
    \
    BASE_URL \cf7 \strokec7 =\cf5 \strokec5  \cf8 \strokec8 "https://api.spotify.com/v1"\cf5 \strokec5 \
    \
    \cf3 \strokec3 def\cf5 \strokec5  \cf7 \strokec7 __init__\cf5 \strokec5 (self):\
        self.load_credentials()\
    \
    \cf3 \strokec3 def\cf5 \strokec5  \cf7 \strokec7 load_credentials\cf5 \strokec5 (self):\
        conn \cf7 \strokec7 =\cf5 \strokec5  sqlite3.connect(\cf8 \strokec8 'yangkidd_pro.db'\cf5 \strokec5 )\
        c \cf7 \strokec7 =\cf5 \strokec5  conn.cursor()\
        c.execute(\cf8 \strokec8 "SELECT client_id, client_secret, access_token, expires_at FROM api_credentials WHERE platform='spotify'"\cf5 \strokec5 )\
        row \cf7 \strokec7 =\cf5 \strokec5  c.fetchone()\
        conn.close()\
        \
        \cf3 \strokec3 if\cf5 \strokec5  row:\
            self.client_id \cf7 \strokec7 =\cf5 \strokec5  row[\cf9 \strokec9 0\cf5 \strokec5 ]\
            self.client_secret \cf7 \strokec7 =\cf5 \strokec5  row[\cf9 \strokec9 1\cf5 \strokec5 ]\
            self.access_token \cf7 \strokec7 =\cf5 \strokec5  row[\cf9 \strokec9 2\cf5 \strokec5 ]\
            self.expires_at \cf7 \strokec7 =\cf5 \strokec5  row[\cf9 \strokec9 3\cf5 \strokec5 ]\
        \cf3 \strokec3 else\cf5 \strokec5 :\
            self.client_id \cf7 \strokec7 =\cf5 \strokec5  \cf9 \strokec9 None\cf5 \strokec5 \
            self.access_token \cf7 \strokec7 =\cf5 \strokec5  \cf9 \strokec9 None\cf5 \strokec5 \
    \
    \cf3 \strokec3 def\cf5 \strokec5  \cf7 \strokec7 save_credentials\cf5 \strokec5 (self, client_id, client_secret, access_token, expires_at):\
        conn \cf7 \strokec7 =\cf5 \strokec5  sqlite3.connect(\cf8 \strokec8 'yangkidd_pro.db'\cf5 \strokec5 )\
        c \cf7 \strokec7 =\cf5 \strokec5  conn.cursor()\
        c.execute(\cf8 \strokec8 """INSERT OR REPLACE INTO api_credentials \
\pard\pardeftab720\partightenfactor0
\cf5 \strokec5                      (platform, client_id, client_secret, access_token, expires_at)\
\pard\pardeftab720\partightenfactor0
\cf8 \strokec8                      VALUES (?, ?, ?, ?, ?)"""\cf5 \strokec5 ,\
                  (\cf8 \strokec8 'spotify'\cf5 \strokec5 , client_id, client_secret, access_token, expires_at))\
        conn.commit()\
        conn.close()\
    \
    \cf3 \strokec3 def\cf5 \strokec5  \cf7 \strokec7 get_auth_url\cf5 \strokec5 (self, client_id, redirect_uri):\
        \cf8 \strokec8 """Genera URL per OAuth"""\cf5 \strokec5 \
        scopes \cf7 \strokec7 =\cf5 \strokec5  \cf8 \strokec8 'user-read-email user-read-private user-top-read'\cf5 \strokec5 \
        params \cf7 \strokec7 =\cf5 \strokec5  \{\
            \cf8 \strokec8 'client_id'\cf5 \strokec5 : client_id,\
            \cf8 \strokec8 'response_type'\cf5 \strokec5 : \cf8 \strokec8 'code'\cf5 \strokec5 ,\
            \cf8 \strokec8 'redirect_uri'\cf5 \strokec5 : redirect_uri,\
            \cf8 \strokec8 'scope'\cf5 \strokec5 : scopes\
        \}\
        \cf3 \strokec3 return\cf5 \strokec5  \cf8 \strokec8 f"https://accounts.spotify.com/authorize?\cf5 \strokec5 \{urlencode(params)\}\cf8 \strokec8 "\cf5 \strokec5 \
    \
    \cf3 \strokec3 def\cf5 \strokec5  \cf7 \strokec7 get_access_token\cf5 \strokec5 (self, client_id, client_secret, code, redirect_uri):\
        \cf8 \strokec8 """Scambia authorization code per access token"""\cf5 \strokec5 \
        auth_str \cf7 \strokec7 =\cf5 \strokec5  \cf8 \strokec8 f"\cf5 \strokec5 \{client_id\}\cf8 \strokec8 :\cf5 \strokec5 \{client_secret\}\cf8 \strokec8 "\cf5 \strokec5 \
        auth_b64 \cf7 \strokec7 =\cf5 \strokec5  base64.b64encode(auth_str.encode()).decode()\
        \
        headers \cf7 \strokec7 =\cf5 \strokec5  \{\
            \cf8 \strokec8 'Authorization'\cf5 \strokec5 : \cf8 \strokec8 f'Basic \cf5 \strokec5 \{auth_b64\}\cf8 \strokec8 '\cf5 \strokec5 ,\
            \cf8 \strokec8 'Content-Type'\cf5 \strokec5 : \cf8 \strokec8 'application/x-www-form-urlencoded'\cf5 \strokec5 \
        \}\
        \
        data \cf7 \strokec7 =\cf5 \strokec5  \{\
            \cf8 \strokec8 'grant_type'\cf5 \strokec5 : \cf8 \strokec8 'authorization_code'\cf5 \strokec5 ,\
            \cf8 \strokec8 'code'\cf5 \strokec5 : code,\
            \cf8 \strokec8 'redirect_uri'\cf5 \strokec5 : redirect_uri\
        \}\
        \
        response \cf7 \strokec7 =\cf5 \strokec5  requests.post(\cf8 \strokec8 'https://accounts.spotify.com/api/token'\cf5 \strokec5 , headers\cf7 \strokec7 =\cf5 \strokec5 headers, data\cf7 \strokec7 =\cf5 \strokec5 data)\
        \
        \cf3 \strokec3 if\cf5 \strokec5  response.status_code \cf7 \strokec7 ==\cf5 \strokec5  \cf9 \strokec9 200\cf5 \strokec5 :\
            token_data \cf7 \strokec7 =\cf5 \strokec5  response.json()\
            expires_at \cf7 \strokec7 =\cf5 \strokec5  datetime.now() \cf7 \strokec7 +\cf5 \strokec5  timedelta(seconds\cf7 \strokec7 =\cf5 \strokec5 token_data[\cf8 \strokec8 'expires_in'\cf5 \strokec5 ])\
            self.save_credentials(client_id, client_secret, token_data[\cf8 \strokec8 'access_token'\cf5 \strokec5 ], \cf8 \strokec8 str\cf5 \strokec5 (expires_at))\
            \cf3 \strokec3 return\cf5 \strokec5  token_data[\cf8 \strokec8 'access_token'\cf5 \strokec5 ]\
        \cf3 \strokec3 return\cf5 \strokec5  \cf9 \strokec9 None\cf5 \strokec5 \
    \
    \cf3 \strokec3 def\cf5 \strokec5  \cf7 \strokec7 get_artist_stats\cf5 \strokec5 (self, artist_id):\
        \cf8 \strokec8 """Recupera statistiche artista"""\cf5 \strokec5 \
        \cf3 \strokec3 if\cf5 \strokec5  \cf3 \strokec3 not\cf5 \strokec5  self.access_token:\
            \cf3 \strokec3 return\cf5 \strokec5  \{\cf8 \strokec8 "error"\cf5 \strokec5 : \cf8 \strokec8 "Token non configurato"\cf5 \strokec5 \}\
        \
        headers \cf7 \strokec7 =\cf5 \strokec5  \{\cf8 \strokec8 'Authorization'\cf5 \strokec5 : \cf8 \strokec8 f'Bearer \cf5 \strokec5 \{self.access_token\}\cf8 \strokec8 '\cf5 \strokec5 \}\
        \
        \cf3 \strokec3 try\cf5 \strokec5 :\
            
\f4\i \cf6 \strokec6 # Get Artist Data
\f3\i0 \cf5 \strokec5 \
            artist_resp \cf7 \strokec7 =\cf5 \strokec5  requests.get(\cf8 \strokec8 f"\cf5 \strokec5 \{self.BASE_URL\}\cf8 \strokec8 /artists/\cf5 \strokec5 \{artist_id\}\cf8 \strokec8 "\cf5 \strokec5 , headers\cf7 \strokec7 =\cf5 \strokec5 headers)\
            \
            \cf3 \strokec3 if\cf5 \strokec5  artist_resp.status_code \cf7 \strokec7 ==\cf5 \strokec5  \cf9 \strokec9 200\cf5 \strokec5 :\
                artist_data \cf7 \strokec7 =\cf5 \strokec5  artist_resp.json()\
                \
                
\f4\i \cf6 \strokec6 # Get Top Tracks
\f3\i0 \cf5 \strokec5 \
                top_tracks_resp \cf7 \strokec7 =\cf5 \strokec5  requests.get(\cf8 \strokec8 f"\cf5 \strokec5 \{self.BASE_URL\}\cf8 \strokec8 /artists/\cf5 \strokec5 \{artist_id\}\cf8 \strokec8 /top-tracks?market=IT"\cf5 \strokec5 , headers\cf7 \strokec7 =\cf5 \strokec5 headers)\
                top_tracks \cf7 \strokec7 =\cf5 \strokec5  top_tracks_resp.json() \cf3 \strokec3 if\cf5 \strokec5  top_tracks_resp.status_code \cf7 \strokec7 ==\cf5 \strokec5  \cf9 \strokec9 200\cf5 \strokec5  \cf3 \strokec3 else\cf5 \strokec5  \{\}\
                \
                \cf3 \strokec3 return\cf5 \strokec5  \{\
                    \cf8 \strokec8 'name'\cf5 \strokec5 : artist_data.get(\cf8 \strokec8 'name'\cf5 \strokec5 ),\
                    \cf8 \strokec8 'followers'\cf5 \strokec5 : artist_data.get(\cf8 \strokec8 'followers'\cf5 \strokec5 , \{\}).get(\cf8 \strokec8 'total'\cf5 \strokec5 , \cf9 \strokec9 0\cf5 \strokec5 ),\
                    \cf8 \strokec8 'popularity'\cf5 \strokec5 : artist_data.get(\cf8 \strokec8 'popularity'\cf5 \strokec5 , \cf9 \strokec9 0\cf5 \strokec5 ),\
                    \cf8 \strokec8 'genres'\cf5 \strokec5 : artist_data.get(\cf8 \strokec8 'genres'\cf5 \strokec5 , []),\
                    \cf8 \strokec8 'top_tracks'\cf5 \strokec5 : top_tracks.get(\cf8 \strokec8 'tracks'\cf5 \strokec5 , [])[:\cf9 \strokec9 5\cf5 \strokec5 ]\
                \}\
            \cf3 \strokec3 else\cf5 \strokec5 :\
                \cf3 \strokec3 return\cf5 \strokec5  \{\cf8 \strokec8 "error"\cf5 \strokec5 : \cf8 \strokec8 f"Errore API: \cf5 \strokec5 \{artist_resp.status_code\}\cf8 \strokec8 "\cf5 \strokec5 \}\
        \
        \cf3 \strokec3 except\cf5 \strokec5  Exception \cf3 \strokec3 as\cf5 \strokec5  e:\
            \cf3 \strokec3 return\cf5 \strokec5  \{\cf8 \strokec8 "error"\cf5 \strokec5 : \cf8 \strokec8 str\cf5 \strokec5 (e)\}\
\
\
\pard\pardeftab720\partightenfactor0
\cf3 \strokec3 class\cf5 \strokec5  \cf9 \strokec9 InstagramAPI\cf5 \strokec5 :\
    \cf8 \strokec8 """Instagram Graph API (richiede Facebook Business Account)"""\cf5 \strokec5 \
    \
    BASE_URL \cf7 \strokec7 =\cf5 \strokec5  \cf8 \strokec8 "https://graph.instagram.com"\cf5 \strokec5 \
    \
    \cf3 \strokec3 def\cf5 \strokec5  \cf7 \strokec7 __init__\cf5 \strokec5 (self):\
        self.load_credentials()\
    \
    \cf3 \strokec3 def\cf5 \strokec5  \cf7 \strokec7 load_credentials\cf5 \strokec5 (self):\
        conn \cf7 \strokec7 =\cf5 \strokec5  sqlite3.connect(\cf8 \strokec8 'yangkidd_pro.db'\cf5 \strokec5 )\
        c \cf7 \strokec7 =\cf5 \strokec5  conn.cursor()\
        c.execute(\cf8 \strokec8 "SELECT access_token FROM api_credentials WHERE platform='instagram'"\cf5 \strokec5 )\
        row \cf7 \strokec7 =\cf5 \strokec5  c.fetchone()\
        conn.close()\
        self.access_token \cf7 \strokec7 =\cf5 \strokec5  row[\cf9 \strokec9 0\cf5 \strokec5 ] \cf3 \strokec3 if\cf5 \strokec5  row \cf3 \strokec3 else\cf5 \strokec5  \cf9 \strokec9 None\cf5 \strokec5 \
    \
    \cf3 \strokec3 def\cf5 \strokec5  \cf7 \strokec7 save_access_token\cf5 \strokec5 (self, token):\
        conn \cf7 \strokec7 =\cf5 \strokec5  sqlite3.connect(\cf8 \strokec8 'yangkidd_pro.db'\cf5 \strokec5 )\
        c \cf7 \strokec7 =\cf5 \strokec5  conn.cursor()\
        c.execute(\cf8 \strokec8 """INSERT OR REPLACE INTO api_credentials \
                     (platform, access_token) VALUES (?, ?)"""\cf5 \strokec5 ,\
                  (\cf8 \strokec8 'instagram'\cf5 \strokec5 , token))\
        conn.commit()\
        conn.close()\
    \
    \cf3 \strokec3 def\cf5 \strokec5  \cf7 \strokec7 get_account_insights\cf5 \strokec5 (self, user_id):\
        \cf8 \strokec8 """Recupera insights account"""\cf5 \strokec5 \
        \cf3 \strokec3 if\cf5 \strokec5  \cf3 \strokec3 not\cf5 \strokec5  self.access_token:\
            \cf3 \strokec3 return\cf5 \strokec5  \{\cf8 \strokec8 "error"\cf5 \strokec5 : \cf8 \strokec8 "Token non configurato"\cf5 \strokec5 \}\
        \
        params \cf7 \strokec7 =\cf5 \strokec5  \{\
            \cf8 \strokec8 'fields'\cf5 \strokec5 : \cf8 \strokec8 'followers_count,media_count,username'\cf5 \strokec5 ,\
            \cf8 \strokec8 'access_token'\cf5 \strokec5 : self.access_token\
        \}\
        \
        \cf3 \strokec3 try\cf5 \strokec5 :\
            response \cf7 \strokec7 =\cf5 \strokec5  requests.get(\cf8 \strokec8 f"\cf5 \strokec5 \{self.BASE_URL\}\cf8 \strokec8 /\cf5 \strokec5 \{user_id\}\cf8 \strokec8 "\cf5 \strokec5 , params\cf7 \strokec7 =\cf5 \strokec5 params)\
            \
            \cf3 \strokec3 if\cf5 \strokec5  response.status_code \cf7 \strokec7 ==\cf5 \strokec5  \cf9 \strokec9 200\cf5 \strokec5 :\
                \cf3 \strokec3 return\cf5 \strokec5  response.json()\
            \cf3 \strokec3 else\cf5 \strokec5 :\
                \cf3 \strokec3 return\cf5 \strokec5  \{\cf8 \strokec8 "error"\cf5 \strokec5 : \cf8 \strokec8 f"Errore API: \cf5 \strokec5 \{response.status_code\}\cf8 \strokec8 "\cf5 \strokec5 \}\
        \
        \cf3 \strokec3 except\cf5 \strokec5  Exception \cf3 \strokec3 as\cf5 \strokec5  e:\
            \cf3 \strokec3 return\cf5 \strokec5  \{\cf8 \strokec8 "error"\cf5 \strokec5 : \cf8 \strokec8 str\cf5 \strokec5 (e)\}\
    \
    \cf3 \strokec3 def\cf5 \strokec5  \cf7 \strokec7 get_media_insights\cf5 \strokec5 (self, user_id, limit\cf7 \strokec7 =\cf9 \strokec9 10\cf5 \strokec5 ):\
        \cf8 \strokec8 """Recupera insights media recenti"""\cf5 \strokec5 \
        \cf3 \strokec3 if\cf5 \strokec5  \cf3 \strokec3 not\cf5 \strokec5  self.access_token:\
            \cf3 \strokec3 return\cf5 \strokec5  \{\cf8 \strokec8 "error"\cf5 \strokec5 : \cf8 \strokec8 "Token non configurato"\cf5 \strokec5 \}\
        \
        params \cf7 \strokec7 =\cf5 \strokec5  \{\
            \cf8 \strokec8 'fields'\cf5 \strokec5 : \cf8 \strokec8 'media\{like_count,comments_count,timestamp,media_type,permalink\}'\cf5 \strokec5 ,\
            \cf8 \strokec8 'access_token'\cf5 \strokec5 : self.access_token\
        \}\
        \
        \cf3 \strokec3 try\cf5 \strokec5 :\
            response \cf7 \strokec7 =\cf5 \strokec5  requests.get(\cf8 \strokec8 f"\cf5 \strokec5 \{self.BASE_URL\}\cf8 \strokec8 /\cf5 \strokec5 \{user_id\}\cf8 \strokec8 "\cf5 \strokec5 , params\cf7 \strokec7 =\cf5 \strokec5 params)\
            \
            \cf3 \strokec3 if\cf5 \strokec5  response.status_code \cf7 \strokec7 ==\cf5 \strokec5  \cf9 \strokec9 200\cf5 \strokec5 :\
                data \cf7 \strokec7 =\cf5 \strokec5  response.json()\
                media_list \cf7 \strokec7 =\cf5 \strokec5  data.get(\cf8 \strokec8 'media'\cf5 \strokec5 , \{\}).get(\cf8 \strokec8 'data'\cf5 \strokec5 , [])[:limit]\
                \
                total_likes \cf7 \strokec7 =\cf5 \strokec5  \cf8 \strokec8 sum\cf5 \strokec5 (m.get(\cf8 \strokec8 'like_count'\cf5 \strokec5 , \cf9 \strokec9 0\cf5 \strokec5 ) \cf3 \strokec3 for\cf5 \strokec5  m \cf3 \strokec3 in\cf5 \strokec5  media_list)\
                total_comments \cf7 \strokec7 =\cf5 \strokec5  \cf8 \strokec8 sum\cf5 \strokec5 (m.get(\cf8 \strokec8 'comments_count'\cf5 \strokec5 , \cf9 \strokec9 0\cf5 \strokec5 ) \cf3 \strokec3 for\cf5 \strokec5  m \cf3 \strokec3 in\cf5 \strokec5  media_list)\
                \
                \cf3 \strokec3 return\cf5 \strokec5  \{\
                    \cf8 \strokec8 'total_posts'\cf5 \strokec5 : \cf8 \strokec8 len\cf5 \strokec5 (media_list),\
                    \cf8 \strokec8 'total_likes'\cf5 \strokec5 : total_likes,\
                    \cf8 \strokec8 'total_comments'\cf5 \strokec5 : total_comments,\
                    \cf8 \strokec8 'avg_engagement'\cf5 \strokec5 : (total_likes \cf7 \strokec7 +\cf5 \strokec5  total_comments) \cf7 \strokec7 /\cf5 \strokec5  \cf8 \strokec8 len\cf5 \strokec5 (media_list) \cf3 \strokec3 if\cf5 \strokec5  media_list \cf3 \strokec3 else\cf5 \strokec5  \cf9 \strokec9 0\cf5 \strokec5 ,\
                    \cf8 \strokec8 'recent_media'\cf5 \strokec5 : media_list\
                \}\
            \cf3 \strokec3 else\cf5 \strokec5 :\
                \cf3 \strokec3 return\cf5 \strokec5  \{\cf8 \strokec8 "error"\cf5 \strokec5 : \cf8 \strokec8 f"Errore API: \cf5 \strokec5 \{response.status_code\}\cf8 \strokec8 "\cf5 \strokec5 \}\
        \
        \cf3 \strokec3 except\cf5 \strokec5  Exception \cf3 \strokec3 as\cf5 \strokec5  e:\
            \cf3 \strokec3 return\cf5 \strokec5  \{\cf8 \strokec8 "error"\cf5 \strokec5 : \cf8 \strokec8 str\cf5 \strokec5 (e)\}\
\
\
\cf3 \strokec3 class\cf5 \strokec5  \cf9 \strokec9 YouTubeAPI\cf5 \strokec5 :\
    \cf8 \strokec8 """YouTube Data API v3"""\cf5 \strokec5 \
    \
    BASE_URL \cf7 \strokec7 =\cf5 \strokec5  \cf8 \strokec8 "https://www.googleapis.com/youtube/v3"\cf5 \strokec5 \
    \
    \cf3 \strokec3 def\cf5 \strokec5  \cf7 \strokec7 __init__\cf5 \strokec5 (self):\
        self.load_credentials()\
    \
    \cf3 \strokec3 def\cf5 \strokec5  \cf7 \strokec7 load_credentials\cf5 \strokec5 (self):\
        conn \cf7 \strokec7 =\cf5 \strokec5  sqlite3.connect(\cf8 \strokec8 'yangkidd_pro.db'\cf5 \strokec5 )\
        c \cf7 \strokec7 =\cf5 \strokec5  conn.cursor()\
        c.execute(\cf8 \strokec8 "SELECT client_id FROM api_credentials WHERE platform='youtube'"\cf5 \strokec5 )\
        row \cf7 \strokec7 =\cf5 \strokec5  c.fetchone()\
        conn.close()\
        self.api_key \cf7 \strokec7 =\cf5 \strokec5  row[\cf9 \strokec9 0\cf5 \strokec5 ] \cf3 \strokec3 if\cf5 \strokec5  row \cf3 \strokec3 else\cf5 \strokec5  \cf9 \strokec9 None\cf5 \strokec5 \
    \
    \cf3 \strokec3 def\cf5 \strokec5  \cf7 \strokec7 save_api_key\cf5 \strokec5 (self, api_key):\
        conn \cf7 \strokec7 =\cf5 \strokec5  sqlite3.connect(\cf8 \strokec8 'yangkidd_pro.db'\cf5 \strokec5 )\
        c \cf7 \strokec7 =\cf5 \strokec5  conn.cursor()\
        c.execute(\cf8 \strokec8 """INSERT OR REPLACE INTO api_credentials \
                     (platform, client_id) VALUES (?, ?)"""\cf5 \strokec5 ,\
                  (\cf8 \strokec8 'youtube'\cf5 \strokec5 , api_key))\
        conn.commit()\
        conn.close()\
    \
    \cf3 \strokec3 def\cf5 \strokec5  \cf7 \strokec7 get_channel_stats\cf5 \strokec5 (self, channel_id):\
        \cf8 \strokec8 """Recupera statistiche canale"""\cf5 \strokec5 \
        \cf3 \strokec3 if\cf5 \strokec5  \cf3 \strokec3 not\cf5 \strokec5  self.api_key:\
            \cf3 \strokec3 return\cf5 \strokec5  \{\cf8 \strokec8 "error"\cf5 \strokec5 : \cf8 \strokec8 "API Key non configurata"\cf5 \strokec5 \}\
        \
        params \cf7 \strokec7 =\cf5 \strokec5  \{\
            \cf8 \strokec8 'part'\cf5 \strokec5 : \cf8 \strokec8 'statistics,snippet'\cf5 \strokec5 ,\
            \cf8 \strokec8 'id'\cf5 \strokec5 : channel_id,\
            \cf8 \strokec8 'key'\cf5 \strokec5 : self.api_key\
        \}\
        \
        \cf3 \strokec3 try\cf5 \strokec5 :\
            response \cf7 \strokec7 =\cf5 \strokec5  requests.get(\cf8 \strokec8 f"\cf5 \strokec5 \{self.BASE_URL\}\cf8 \strokec8 /channels"\cf5 \strokec5 , params\cf7 \strokec7 =\cf5 \strokec5 params)\
            \
            \cf3 \strokec3 if\cf5 \strokec5  response.status_code \cf7 \strokec7 ==\cf5 \strokec5  \cf9 \strokec9 200\cf5 \strokec5 :\
                data \cf7 \strokec7 =\cf5 \strokec5  response.json()\
                \cf3 \strokec3 if\cf5 \strokec5  data.get(\cf8 \strokec8 'items'\cf5 \strokec5 ):\
                    item \cf7 \strokec7 =\cf5 \strokec5  data[\cf8 \strokec8 'items'\cf5 \strokec5 ][\cf9 \strokec9 0\cf5 \strokec5 ]\
                    stats \cf7 \strokec7 =\cf5 \strokec5  item.get(\cf8 \strokec8 'statistics'\cf5 \strokec5 , \{\})\
                    \
                    \cf3 \strokec3 return\cf5 \strokec5  \{\
                        \cf8 \strokec8 'channel_name'\cf5 \strokec5 : item.get(\cf8 \strokec8 'snippet'\cf5 \strokec5 , \{\}).get(\cf8 \strokec8 'title'\cf5 \strokec5 ),\
                        \cf8 \strokec8 'subscribers'\cf5 \strokec5 : \cf8 \strokec8 int\cf5 \strokec5 (stats.get(\cf8 \strokec8 'subscriberCount'\cf5 \strokec5 , \cf9 \strokec9 0\cf5 \strokec5 )),\
                        \cf8 \strokec8 'total_views'\cf5 \strokec5 : \cf8 \strokec8 int\cf5 \strokec5 (stats.get(\cf8 \strokec8 'viewCount'\cf5 \strokec5 , \cf9 \strokec9 0\cf5 \strokec5 )),\
                        \cf8 \strokec8 'video_count'\cf5 \strokec5 : \cf8 \strokec8 int\cf5 \strokec5 (stats.get(\cf8 \strokec8 'videoCount'\cf5 \strokec5 , \cf9 \strokec9 0\cf5 \strokec5 ))\
                    \}\
                \cf3 \strokec3 else\cf5 \strokec5 :\
                    \cf3 \strokec3 return\cf5 \strokec5  \{\cf8 \strokec8 "error"\cf5 \strokec5 : \cf8 \strokec8 "Canale non trovato"\cf5 \strokec5 \}\
            \cf3 \strokec3 else\cf5 \strokec5 :\
                \cf3 \strokec3 return\cf5 \strokec5  \{\cf8 \strokec8 "error"\cf5 \strokec5 : \cf8 \strokec8 f"Errore API: \cf5 \strokec5 \{response.status_code\}\cf8 \strokec8 "\cf5 \strokec5 \}\
        \
        \cf3 \strokec3 except\cf5 \strokec5  Exception \cf3 \strokec3 as\cf5 \strokec5  e:\
            \cf3 \strokec3 return\cf5 \strokec5  \{\cf8 \strokec8 "error"\cf5 \strokec5 : \cf8 \strokec8 str\cf5 \strokec5 (e)\}\
    \
    \cf3 \strokec3 def\cf5 \strokec5  \cf7 \strokec7 get_video_stats\cf5 \strokec5 (self, video_id):\
        \cf8 \strokec8 """Recupera statistiche video"""\cf5 \strokec5 \
        \cf3 \strokec3 if\cf5 \strokec5  \cf3 \strokec3 not\cf5 \strokec5  self.api_key:\
            \cf3 \strokec3 return\cf5 \strokec5  \{\cf8 \strokec8 "error"\cf5 \strokec5 : \cf8 \strokec8 "API Key non configurata"\cf5 \strokec5 \}\
        \
        params \cf7 \strokec7 =\cf5 \strokec5  \{\
            \cf8 \strokec8 'part'\cf5 \strokec5 : \cf8 \strokec8 'statistics,snippet'\cf5 \strokec5 ,\
            \cf8 \strokec8 'id'\cf5 \strokec5 : video_id,\
            \cf8 \strokec8 'key'\cf5 \strokec5 : self.api_key\
        \}\
        \
        \cf3 \strokec3 try\cf5 \strokec5 :\
            response \cf7 \strokec7 =\cf5 \strokec5  requests.get(\cf8 \strokec8 f"\cf5 \strokec5 \{self.BASE_URL\}\cf8 \strokec8 /videos"\cf5 \strokec5 , params\cf7 \strokec7 =\cf5 \strokec5 params)\
            \
            \cf3 \strokec3 if\cf5 \strokec5  response.status_code \cf7 \strokec7 ==\cf5 \strokec5  \cf9 \strokec9 200\cf5 \strokec5 :\
                data \cf7 \strokec7 =\cf5 \strokec5  response.json()\
                \cf3 \strokec3 if\cf5 \strokec5  data.get(\cf8 \strokec8 'items'\cf5 \strokec5 ):\
                    item \cf7 \strokec7 =\cf5 \strokec5  data[\cf8 \strokec8 'items'\cf5 \strokec5 ][\cf9 \strokec9 0\cf5 \strokec5 ]\
                    stats \cf7 \strokec7 =\cf5 \strokec5  item.get(\cf8 \strokec8 'statistics'\cf5 \strokec5 , \{\})\
                    \
                    \cf3 \strokec3 return\cf5 \strokec5  \{\
                        \cf8 \strokec8 'title'\cf5 \strokec5 : item.get(\cf8 \strokec8 'snippet'\cf5 \strokec5 , \{\}).get(\cf8 \strokec8 'title'\cf5 \strokec5 ),\
                        \cf8 \strokec8 'views'\cf5 \strokec5 : \cf8 \strokec8 int\cf5 \strokec5 (stats.get(\cf8 \strokec8 'viewCount'\cf5 \strokec5 , \cf9 \strokec9 0\cf5 \strokec5 )),\
                        \cf8 \strokec8 'likes'\cf5 \strokec5 : \cf8 \strokec8 int\cf5 \strokec5 (stats.get(\cf8 \strokec8 'likeCount'\cf5 \strokec5 , \cf9 \strokec9 0\cf5 \strokec5 )),\
                        \cf8 \strokec8 'comments'\cf5 \strokec5 : \cf8 \strokec8 int\cf5 \strokec5 (stats.get(\cf8 \strokec8 'commentCount'\cf5 \strokec5 , \cf9 \strokec9 0\cf5 \strokec5 )),\
                        \cf8 \strokec8 'published_at'\cf5 \strokec5 : item.get(\cf8 \strokec8 'snippet'\cf5 \strokec5 , \{\}).get(\cf8 \strokec8 'publishedAt'\cf5 \strokec5 )\
                    \}\
                \cf3 \strokec3 else\cf5 \strokec5 :\
                    \cf3 \strokec3 return\cf5 \strokec5  \{\cf8 \strokec8 "error"\cf5 \strokec5 : \cf8 \strokec8 "Video non trovato"\cf5 \strokec5 \}\
            \cf3 \strokec3 else\cf5 \strokec5 :\
                \cf3 \strokec3 return\cf5 \strokec5  \{\cf8 \strokec8 "error"\cf5 \strokec5 : \cf8 \strokec8 f"Errore API: \cf5 \strokec5 \{response.status_code\}\cf8 \strokec8 "\cf5 \strokec5 \}\
        \
        \cf3 \strokec3 except\cf5 \strokec5  Exception \cf3 \strokec3 as\cf5 \strokec5  e:\
            \cf3 \strokec3 return\cf5 \strokec5  \{\cf8 \strokec8 "error"\cf5 \strokec5 : \cf8 \strokec8 str\cf5 \strokec5 (e)\}\
\
\
\cf3 \strokec3 class\cf5 \strokec5  \cf9 \strokec9 TikTokAPI\cf5 \strokec5 :\
    \cf8 \strokec8 """TikTok API (Note: Richiede TikTok for Business Account)"""\cf5 \strokec5 \
    \
    \cf3 \strokec3 def\cf5 \strokec5  \cf7 \strokec7 __init__\cf5 \strokec5 (self):\
        st.warning(\cf8 \strokec8 "\uc0\u9888 \u65039  TikTok API richiede account Business approvato. Usa scraping manuale o export CSV."\cf5 \strokec5 )\
    \
    \cf3 \strokec3 def\cf5 \strokec5  \cf7 \strokec7 manual_import\cf5 \strokec5 (self, data_dict):\
        \cf8 \strokec8 """Import manuale dati TikTok"""\cf5 \strokec5 \
        conn \cf7 \strokec7 =\cf5 \strokec5  sqlite3.connect(\cf8 \strokec8 'yangkidd_pro.db'\cf5 \strokec5 )\
        c \cf7 \strokec7 =\cf5 \strokec5  conn.cursor()\
        \
        c.execute(\cf8 \strokec8 """INSERT INTO platform_stats \
\pard\pardeftab720\partightenfactor0
\cf5 \strokec5                      (platform, metric_name, metric_value, date, raw_data)\
\pard\pardeftab720\partightenfactor0
\cf8 \strokec8                      VALUES (?, ?, ?, ?, ?)"""\cf5 \strokec5 ,\
                  (\cf8 \strokec8 'tiktok'\cf5 \strokec5 , \cf8 \strokec8 'manual_import'\cf5 \strokec5 , \cf9 \strokec9 0\cf5 \strokec5 , datetime.now().strftime(\cf8 \strokec8 '%Y-%m-%d'\cf5 \strokec5 ), \
                   json.dumps(data_dict)))\
        \
        conn.commit()\
        conn.close()\
        \
        \cf3 \strokec3 return\cf5 \strokec5  \{\cf8 \strokec8 "status"\cf5 \strokec5 : \cf8 \strokec8 "success"\cf5 \strokec5 , \cf8 \strokec8 "message"\cf5 \strokec5 : \cf8 \strokec8 "Dati TikTok salvati"\cf5 \strokec5 \}\
\
\
\pard\pardeftab720\partightenfactor0
\cf3 \strokec3 def\cf5 \strokec5  \cf7 \strokec7 save_platform_stats\cf5 \strokec5 (platform, stats_dict):\
    \cf8 \strokec8 """Salva statistiche piattaforma nel DB"""\cf5 \strokec5 \
    conn \cf7 \strokec7 =\cf5 \strokec5  sqlite3.connect(\cf8 \strokec8 'yangkidd_pro.db'\cf5 \strokec5 )\
    c \cf7 \strokec7 =\cf5 \strokec5  conn.cursor()\
    \
    date_str \cf7 \strokec7 =\cf5 \strokec5  datetime.now().strftime(\cf8 \strokec8 '%Y-%m-%d'\cf5 \strokec5 )\
    \
    \cf3 \strokec3 for\cf5 \strokec5  metric_name, metric_value \cf3 \strokec3 in\cf5 \strokec5  stats_dict.items():\
        \cf3 \strokec3 if\cf5 \strokec5  \cf8 \strokec8 isinstance\cf5 \strokec5 (metric_value, (\cf8 \strokec8 int\cf5 \strokec5 , \cf8 \strokec8 float\cf5 \strokec5 )):\
            c.execute(\cf8 \strokec8 """INSERT INTO platform_stats \
\pard\pardeftab720\partightenfactor0
\cf5 \strokec5                          (platform, metric_name, metric_value, date, raw_data)\
\pard\pardeftab720\partightenfactor0
\cf8 \strokec8                          VALUES (?, ?, ?, ?, ?)"""\cf5 \strokec5 ,\
                      (platform, metric_name, metric_value, date_str, json.dumps(stats_dict)))\
    \
    conn.commit()\
    conn.close()\
\
\pard\pardeftab720\partightenfactor0
\cf3 \strokec3 def\cf5 \strokec5  \cf7 \strokec7 get_platform_stats\cf5 \strokec5 (platform, days\cf7 \strokec7 =\cf9 \strokec9 30\cf5 \strokec5 ):\
    \cf8 \strokec8 """Recupera storico statistiche"""\cf5 \strokec5 \
    conn \cf7 \strokec7 =\cf5 \strokec5  sqlite3.connect(\cf8 \strokec8 'yangkidd_pro.db'\cf5 \strokec5 )\
    date_from \cf7 \strokec7 =\cf5 \strokec5  (datetime.now() \cf7 \strokec7 -\cf5 \strokec5  timedelta(days\cf7 \strokec7 =\cf5 \strokec5 days)).strftime(\cf8 \strokec8 '%Y-%m-%d'\cf5 \strokec5 )\
    \
    df \cf7 \strokec7 =\cf5 \strokec5  pd.read_sql_query(\
        \cf8 \strokec8 """SELECT * FROM platform_stats \
\pard\pardeftab720\partightenfactor0
\cf5 \strokec5            WHERE platform=? AND date >= ?\
\pard\pardeftab720\partightenfactor0
\cf8 \strokec8            ORDER BY date DESC"""\cf5 \strokec5 ,\
        conn, params\cf7 \strokec7 =\cf5 \strokec5 (platform, date_from))\
    \
    conn.close()\
    \cf3 \strokec3 return\cf5 \strokec5  df\
\
\pard\pardeftab720\partightenfactor0

\f4\i \cf6 \strokec6 # --- ANALYTICS ENGINE ---
\f3\i0 \cf5 \strokec5 \
\pard\pardeftab720\partightenfactor0
\cf3 \strokec3 def\cf5 \strokec5  \cf7 \strokec7 calculate_advanced_metrics\cf5 \strokec5 (df):\
    \cf3 \strokec3 if\cf5 \strokec5  df.empty:\
        \cf3 \strokec3 return\cf5 \strokec5  \{\}\
    \
    metrics \cf7 \strokec7 =\cf5 \strokec5  \{\
        \cf8 \strokec8 'total_spend'\cf5 \strokec5 : df[\cf8 \strokec8 'spend'\cf5 \strokec5 ].\cf8 \strokec8 sum\cf5 \strokec5 (),\
        \cf8 \strokec8 'total_revenue'\cf5 \strokec5 : df[\cf8 \strokec8 'revenue'\cf5 \strokec5 ].\cf8 \strokec8 sum\cf5 \strokec5 (),\
        \cf8 \strokec8 'avg_roas'\cf5 \strokec5 : df[\cf8 \strokec8 'roas'\cf5 \strokec5 ].mean(),\
        \cf8 \strokec8 'best_platform'\cf5 \strokec5 : df.groupby(\cf8 \strokec8 'platform'\cf5 \strokec5 )[\cf8 \strokec8 'roas'\cf5 \strokec5 ].mean().idxmax() \cf3 \strokec3 if\cf5 \strokec5  \cf8 \strokec8 len\cf5 \strokec5 (df) \cf7 \strokec7 >\cf5 \strokec5  \cf9 \strokec9 0\cf5 \strokec5  \cf3 \strokec3 else\cf5 \strokec5  \cf8 \strokec8 'N/A'\cf5 \strokec5 ,\
        \cf8 \strokec8 'total_streams'\cf5 \strokec5 : df[\cf8 \strokec8 'streams'\cf5 \strokec5 ].\cf8 \strokec8 sum\cf5 \strokec5 (),\
        \cf8 \strokec8 'avg_ctr'\cf5 \strokec5 : df[\cf8 \strokec8 'ctr'\cf5 \strokec5 ].mean(),\
        \cf8 \strokec8 'efficiency_score'\cf5 \strokec5 : (df[\cf8 \strokec8 'revenue'\cf5 \strokec5 ].\cf8 \strokec8 sum\cf5 \strokec5 () \cf7 \strokec7 /\cf5 \strokec5  df[\cf8 \strokec8 'spend'\cf5 \strokec5 ].\cf8 \strokec8 sum\cf5 \strokec5 () \cf7 \strokec7 *\cf5 \strokec5  \cf9 \strokec9 100\cf5 \strokec5 ) \cf3 \strokec3 if\cf5 \strokec5  df[\cf8 \strokec8 'spend'\cf5 \strokec5 ].\cf8 \strokec8 sum\cf5 \strokec5 () \cf7 \strokec7 >\cf5 \strokec5  \cf9 \strokec9 0\cf5 \strokec5  \cf3 \strokec3 else\cf5 \strokec5  \cf9 \strokec9 0\cf5 \strokec5 \
    \}\
    \
    
\f4\i \cf6 \strokec6 # Calcola trend (ultimi 7 vs precedenti 7 giorni)
\f3\i0 \cf5 \strokec5 \
    \cf3 \strokec3 if\cf5 \strokec5  \cf8 \strokec8 len\cf5 \strokec5 (df) \cf7 \strokec7 >=\cf5 \strokec5  \cf9 \strokec9 2\cf5 \strokec5 :\
        recent \cf7 \strokec7 =\cf5 \strokec5  df.head(\cf8 \strokec8 len\cf5 \strokec5 (df)\cf7 \strokec7 //\cf9 \strokec9 2\cf5 \strokec5 )\
        old \cf7 \strokec7 =\cf5 \strokec5  df.tail(\cf8 \strokec8 len\cf5 \strokec5 (df)\cf7 \strokec7 //\cf9 \strokec9 2\cf5 \strokec5 )\
        metrics[\cf8 \strokec8 'revenue_trend'\cf5 \strokec5 ] \cf7 \strokec7 =\cf5 \strokec5  ((recent[\cf8 \strokec8 'revenue'\cf5 \strokec5 ].\cf8 \strokec8 sum\cf5 \strokec5 () \cf7 \strokec7 -\cf5 \strokec5  old[\cf8 \strokec8 'revenue'\cf5 \strokec5 ].\cf8 \strokec8 sum\cf5 \strokec5 ()) \cf7 \strokec7 /\cf5 \strokec5  old[\cf8 \strokec8 'revenue'\cf5 \strokec5 ].\cf8 \strokec8 sum\cf5 \strokec5 () \cf7 \strokec7 *\cf5 \strokec5  \cf9 \strokec9 100\cf5 \strokec5 ) \cf3 \strokec3 if\cf5 \strokec5  old[\cf8 \strokec8 'revenue'\cf5 \strokec5 ].\cf8 \strokec8 sum\cf5 \strokec5 () \cf7 \strokec7 >\cf5 \strokec5  \cf9 \strokec9 0\cf5 \strokec5  \cf3 \strokec3 else\cf5 \strokec5  \cf9 \strokec9 0\cf5 \strokec5 \
    \
    \cf3 \strokec3 return\cf5 \strokec5  metrics\
\
\pard\pardeftab720\partightenfactor0

\f4\i \cf6 \strokec6 # --- AI ENGINE CON CONTESTO ---
\f3\i0 \cf5 \strokec5 \
MODEL \cf7 \strokec7 =\cf5 \strokec5  \cf8 \strokec8 "mistral-nemo"\cf5 \strokec5 \
\
\pard\pardeftab720\partightenfactor0
\cf3 \strokec3 def\cf5 \strokec5  \cf7 \strokec7 generate_contextual_response\cf5 \strokec5 (messages, campaign_data):\
    \cf8 \strokec8 """AI con accesso completo ai dati"""\cf5 \strokec5 \
    \
    
\f4\i \cf6 \strokec6 # Prepara contesto numerico
\f3\i0 \cf5 \strokec5 \
    context \cf7 \strokec7 =\cf5 \strokec5  \cf8 \strokec8 f"""\
\pard\pardeftab720\partightenfactor0
\cf5 \strokec5     DATI REAL-TIME YANGKIDD:\
\pard\pardeftab720\partightenfactor0
\cf8 \strokec8     - Campagne Attive: \cf5 \strokec5 \{\cf8 \strokec8 len\cf5 \strokec5 (campaign_data)\}\cf8 \strokec8 \
    - Budget Totale: \'80\cf5 \strokec5 \{campaign_data[\cf8 \strokec8 'spend'\cf5 \strokec5 ].\cf8 \strokec8 sum\cf5 \strokec5 ():.0f\}\cf8 \strokec8 \
    - Revenue Totale: \'80\cf5 \strokec5 \{campaign_data[\cf8 \strokec8 'revenue'\cf5 \strokec5 ].\cf8 \strokec8 sum\cf5 \strokec5 ():.0f\}\cf8 \strokec8 \
    - ROAS Medio: \cf5 \strokec5 \{campaign_data[\cf8 \strokec8 'roas'\cf5 \strokec5 ].mean():.2f\}\cf8 \strokec8 x\
    - Streams Totali: \cf5 \strokec5 \{campaign_data[\cf8 \strokec8 'streams'\cf5 \strokec5 ].\cf8 \strokec8 sum\cf5 \strokec5 ():,\}\cf8 \strokec8 \
    - CTR Medio: \cf5 \strokec5 \{campaign_data[\cf8 \strokec8 'ctr'\cf5 \strokec5 ].mean():.2f\}\cf8 \strokec8 %\
\pard\pardeftab720\partightenfactor0
\cf5 \strokec5     \
    TOP 3 CAMPAGNE:\
\pard\pardeftab720\partightenfactor0
\cf8 \strokec8     \cf5 \strokec5 \{campaign_data.nlargest(\cf9 \strokec9 3\cf5 \strokec5 , \cf8 \strokec8 'roas'\cf5 \strokec5 )[[\cf8 \strokec8 'name'\cf5 \strokec5 , \cf8 \strokec8 'platform'\cf5 \strokec5 , \cf8 \strokec8 'roas'\cf5 \strokec5 , \cf8 \strokec8 'streams'\cf5 \strokec5 ]].to_string()\}\cf8 \strokec8 \
\pard\pardeftab720\partightenfactor0
\cf5 \strokec5     \
    WORST 2 CAMPAGNE:\
\pard\pardeftab720\partightenfactor0
\cf8 \strokec8     \cf5 \strokec5 \{campaign_data.nsmallest(\cf9 \strokec9 2\cf5 \strokec5 , \cf8 \strokec8 'roas'\cf5 \strokec5 )[[\cf8 \strokec8 'name'\cf5 \strokec5 , \cf8 \strokec8 'platform'\cf5 \strokec5 , \cf8 \strokec8 'roas'\cf5 \strokec5 , \cf8 \strokec8 'spend'\cf5 \strokec5 ]].to_string()\}\cf8 \strokec8 \
    """\cf5 \strokec5 \
    \
    system_prompt \cf7 \strokec7 =\cf5 \strokec5  \{\
        \cf8 \strokec8 "role"\cf5 \strokec5 : \cf8 \strokec8 "system"\cf5 \strokec5 ,\
        \cf8 \strokec8 "content"\cf5 \strokec5 : \cf8 \strokec8 f"""Sei il Manager AI di YangKidd, artista trap/hip-hop italiano.\
\pard\pardeftab720\partightenfactor0
\cf5 \strokec5         \
        CONTESTO DATI:\
\pard\pardeftab720\partightenfactor0
\cf8 \strokec8         \cf5 \strokec5 \{context\}\cf8 \strokec8 \
\pard\pardeftab720\partightenfactor0
\cf5 \strokec5         \
        REGOLE:\
        1. Rispondi SEMPRE con numeri specifici dai dati sopra\
        2. Se chiede strategie, proponi basandoti su performance reali\
        3. Identifica pattern (es: "Meta Ads funziona meglio di TikTok perch\'e9 ROAS 3.2x vs 1.8x")\
        4. Dai consigli ACTIONABLE: taglia budget, scala, cambia target\
        5. Parla come un manager spietato ma professionale\
        6. Massimo 4-5 righe per risposta, bullets solo se necessari\
        \
\pard\pardeftab720\partightenfactor0
\cf8 \strokec8         NON dare risposte generiche. Usa i dati."""\cf5 \strokec5 \
    \}\
    \
    full_messages \cf7 \strokec7 =\cf5 \strokec5  [system_prompt] \cf7 \strokec7 +\cf5 \strokec5  messages\
    \
    \cf3 \strokec3 try\cf5 \strokec5 :\
        stream \cf7 \strokec7 =\cf5 \strokec5  ollama.chat(model\cf7 \strokec7 =\cf5 \strokec5 MODEL, messages\cf7 \strokec7 =\cf5 \strokec5 full_messages, stream\cf7 \strokec7 =\cf9 \strokec9 True\cf5 \strokec5 )\
        \cf3 \strokec3 for\cf5 \strokec5  chunk \cf3 \strokec3 in\cf5 \strokec5  stream:\
            \cf3 \strokec3 yield\cf5 \strokec5  chunk[\cf8 \strokec8 'message'\cf5 \strokec5 ][\cf8 \strokec8 'content'\cf5 \strokec5 ]\
    \cf3 \strokec3 except\cf5 \strokec5  Exception \cf3 \strokec3 as\cf5 \strokec5  e:\
        \cf3 \strokec3 yield\cf5 \strokec5  \cf8 \strokec8 f"\uc0\u9888 \u65039  Errore: \cf5 \strokec5 \{\cf8 \strokec8 str\cf5 \strokec5 (e)\}\cf8 \strokec8 . Verifica che Ollama sia attivo."\cf5 \strokec5 \
\
\pard\pardeftab720\partightenfactor0

\f4\i \cf6 \strokec6 # --- INTERFACCIA ---
\f3\i0 \cf5 \strokec5 \
\

\f4\i \cf6 \strokec6 # Inizializza session_id
\f3\i0 \cf5 \strokec5 \
\pard\pardeftab720\partightenfactor0
\cf3 \strokec3 if\cf5 \strokec5  \cf8 \strokec8 'session_id'\cf5 \strokec5  \cf3 \strokec3 not\cf5 \strokec5  \cf3 \strokec3 in\cf5 \strokec5  st.session_state:\
    st.session_state.session_id \cf7 \strokec7 =\cf5 \strokec5  \cf8 \strokec8 f"session_\cf5 \strokec5 \{datetime.now().strftime(\cf8 \strokec8 '%Y%m%d_%H%M%S'\cf5 \strokec5 )\}\cf8 \strokec8 "\cf5 \strokec5 \
\
\pard\pardeftab720\partightenfactor0

\f4\i \cf6 \strokec6 # Sidebar
\f3\i0 \cf5 \strokec5 \
\pard\pardeftab720\partightenfactor0
\cf3 \strokec3 with\cf5 \strokec5  st.sidebar:\
    st.title(\cf8 \strokec8 "\uc0\u55357 \u56462  ENTERPRISE OS"\cf5 \strokec5 )\
    nav \cf7 \strokec7 =\cf5 \strokec5  st.radio(\cf8 \strokec8 "MODULI"\cf5 \strokec5 , [\cf8 \strokec8 "\uc0\u55356 \u57263  Dashboard Intelligence"\cf5 \strokec5 , \cf8 \strokec8 "\uc0\u55357 \u56492  AI Strategy Room"\cf5 \strokec5 , \cf8 \strokec8 "\uc0\u9881 \u65039  Campaign Manager"\cf5 \strokec5 , \cf8 \strokec8 "\uc0\u55357 \u56588  API Manager"\cf5 \strokec5 ])\
    \
    st.divider()\
    df \cf7 \strokec7 =\cf5 \strokec5  get_campaigns()\
    \cf3 \strokec3 if\cf5 \strokec5  \cf3 \strokec3 not\cf5 \strokec5  df.empty:\
        metrics \cf7 \strokec7 =\cf5 \strokec5  calculate_advanced_metrics(df)\
        st.metric(\cf8 \strokec8 "\uc0\u55357 \u56496  Total Spend"\cf5 \strokec5 , \cf8 \strokec8 f"\'80\cf5 \strokec5 \{metrics[\cf8 \strokec8 'total_spend'\cf5 \strokec5 ]:,.0f\}\cf8 \strokec8 "\cf5 \strokec5 )\
        st.metric(\cf8 \strokec8 "\uc0\u55357 \u56520  Total Revenue"\cf5 \strokec5 , \cf8 \strokec8 f"\'80\cf5 \strokec5 \{metrics[\cf8 \strokec8 'total_revenue'\cf5 \strokec5 ]:,.0f\}\cf8 \strokec8 "\cf5 \strokec5 )\
        st.metric(\cf8 \strokec8 "\uc0\u55356 \u57263  Efficiency"\cf5 \strokec5 , \cf8 \strokec8 f"\cf5 \strokec5 \{metrics[\cf8 \strokec8 'efficiency_score'\cf5 \strokec5 ]:.1f\}\cf8 \strokec8 %"\cf5 \strokec5 )\
        st.metric(\cf8 \strokec8 "\uc0\u55357 \u56613  Avg ROAS"\cf5 \strokec5 , \cf8 \strokec8 f"\cf5 \strokec5 \{metrics[\cf8 \strokec8 'avg_roas'\cf5 \strokec5 ]:.2f\}\cf8 \strokec8 x"\cf5 \strokec5 )\
\
\pard\pardeftab720\partightenfactor0

\f4\i \cf6 \strokec6 # --- DASHBOARD ---
\f3\i0 \cf5 \strokec5 \
\pard\pardeftab720\partightenfactor0
\cf3 \strokec3 if\cf5 \strokec5  nav \cf7 \strokec7 ==\cf5 \strokec5  \cf8 \strokec8 "\uc0\u55356 \u57263  Dashboard Intelligence"\cf5 \strokec5 :\
    st.title(\cf8 \strokec8 "\uc0\u55357 \u56522  Marketing Intelligence Center"\cf5 \strokec5 )\
    \
    df \cf7 \strokec7 =\cf5 \strokec5  get_campaigns()\
    \
    \cf3 \strokec3 if\cf5 \strokec5  df.empty:\
        st.warning(\cf8 \strokec8 "\uc0\u9888 \u65039  Nessuna campagna. Vai su 'Campaign Manager' per iniziare."\cf5 \strokec5 )\
    \cf3 \strokec3 else\cf5 \strokec5 :\
        metrics \cf7 \strokec7 =\cf5 \strokec5  calculate_advanced_metrics(df)\
        \
        
\f4\i \cf6 \strokec6 # Top Metrics
\f3\i0 \cf5 \strokec5 \
        col1, col2, col3, col4 \cf7 \strokec7 =\cf5 \strokec5  st.columns(\cf9 \strokec9 4\cf5 \strokec5 )\
        col1.metric(\cf8 \strokec8 "\uc0\u55357 \u56496  Total Spend"\cf5 \strokec5 , \cf8 \strokec8 f"\'80\cf5 \strokec5 \{metrics[\cf8 \strokec8 'total_spend'\cf5 \strokec5 ]:,.0f\}\cf8 \strokec8 "\cf5 \strokec5 )\
        col2.metric(\cf8 \strokec8 "\uc0\u55357 \u56520  Revenue"\cf5 \strokec5 , \cf8 \strokec8 f"\'80\cf5 \strokec5 \{metrics[\cf8 \strokec8 'total_revenue'\cf5 \strokec5 ]:,.0f\}\cf8 \strokec8 "\cf5 \strokec5 , \
                    delta\cf7 \strokec7 =\cf8 \strokec8 f"\cf5 \strokec5 \{metrics.get(\cf8 \strokec8 'revenue_trend'\cf5 \strokec5 , \cf9 \strokec9 0\cf5 \strokec5 ):.1f\}\cf8 \strokec8 %"\cf5 \strokec5  \cf3 \strokec3 if\cf5 \strokec5  \cf8 \strokec8 'revenue_trend'\cf5 \strokec5  \cf3 \strokec3 in\cf5 \strokec5  metrics \cf3 \strokec3 else\cf5 \strokec5  \cf9 \strokec9 None\cf5 \strokec5 )\
        col3.metric(\cf8 \strokec8 "\uc0\u55356 \u57263  Avg ROAS"\cf5 \strokec5 , \cf8 \strokec8 f"\cf5 \strokec5 \{metrics[\cf8 \strokec8 'avg_roas'\cf5 \strokec5 ]:.2f\}\cf8 \strokec8 x"\cf5 \strokec5 )\
        col4.metric(\cf8 \strokec8 "\uc0\u55357 \u56613  Best Platform"\cf5 \strokec5 , metrics[\cf8 \strokec8 'best_platform'\cf5 \strokec5 ])\
        \
        st.divider()\
        \
        
\f4\i \cf6 \strokec6 # Grafici Avanzati
\f3\i0 \cf5 \strokec5 \
        col_g1, col_g2 \cf7 \strokec7 =\cf5 \strokec5  st.columns(\cf9 \strokec9 2\cf5 \strokec5 )\
        \
        \cf3 \strokec3 with\cf5 \strokec5  col_g1:\
            st.subheader(\cf8 \strokec8 "\uc0\u55357 \u56504  ROAS per Piattaforma"\cf5 \strokec5 )\
            fig1 \cf7 \strokec7 =\cf5 \strokec5  px.bar(df, x\cf7 \strokec7 =\cf8 \strokec8 'platform'\cf5 \strokec5 , y\cf7 \strokec7 =\cf8 \strokec8 'roas'\cf5 \strokec5 , color\cf7 \strokec7 =\cf8 \strokec8 'platform'\cf5 \strokec5 ,\
                         title\cf7 \strokec7 =\cf8 \strokec8 "Return on Ad Spend"\cf5 \strokec5 , template\cf7 \strokec7 =\cf8 \strokec8 "plotly_dark"\cf5 \strokec5 ,\
                         color_discrete_sequence\cf7 \strokec7 =\cf5 \strokec5 px.colors.sequential.Plasma)\
            st.plotly_chart(fig1, use_container_width\cf7 \strokec7 =\cf9 \strokec9 True\cf5 \strokec5 )\
        \
        \cf3 \strokec3 with\cf5 \strokec5  col_g2:\
            st.subheader(\cf8 \strokec8 "\uc0\u55357 \u56522  Performance Matrix"\cf5 \strokec5 )\
            fig2 \cf7 \strokec7 =\cf5 \strokec5  px.scatter(df, x\cf7 \strokec7 =\cf8 \strokec8 'spend'\cf5 \strokec5 , y\cf7 \strokec7 =\cf8 \strokec8 'revenue'\cf5 \strokec5 , size\cf7 \strokec7 =\cf8 \strokec8 'streams'\cf5 \strokec5 , color\cf7 \strokec7 =\cf8 \strokec8 'platform'\cf5 \strokec5 ,\
                             hover_data\cf7 \strokec7 =\cf5 \strokec5 [\cf8 \strokec8 'name'\cf5 \strokec5 , \cf8 \strokec8 'roas'\cf5 \strokec5 , \cf8 \strokec8 'ctr'\cf5 \strokec5 ], title\cf7 \strokec7 =\cf8 \strokec8 "Efficienza Campagne"\cf5 \strokec5 ,\
                             template\cf7 \strokec7 =\cf8 \strokec8 "plotly_dark"\cf5 \strokec5 )\
            st.plotly_chart(fig2, use_container_width\cf7 \strokec7 =\cf9 \strokec9 True\cf5 \strokec5 )\
        \
        
\f4\i \cf6 \strokec6 # Streams Analysis
\f3\i0 \cf5 \strokec5 \
        st.subheader(\cf8 \strokec8 "\uc0\u55356 \u57269  Stream Performance"\cf5 \strokec5 )\
        fig3 \cf7 \strokec7 =\cf5 \strokec5  px.bar(df, x\cf7 \strokec7 =\cf8 \strokec8 'name'\cf5 \strokec5 , y\cf7 \strokec7 =\cf8 \strokec8 'streams'\cf5 \strokec5 , color\cf7 \strokec7 =\cf8 \strokec8 'platform'\cf5 \strokec5 ,\
                     title\cf7 \strokec7 =\cf8 \strokec8 "Streams per Campagna"\cf5 \strokec5 , template\cf7 \strokec7 =\cf8 \strokec8 "plotly_dark"\cf5 \strokec5 )\
        st.plotly_chart(fig3, use_container_width\cf7 \strokec7 =\cf9 \strokec9 True\cf5 \strokec5 )\
        \
        
\f4\i \cf6 \strokec6 # Tabella Dettagliata
\f3\i0 \cf5 \strokec5 \
        st.subheader(\cf8 \strokec8 "\uc0\u55357 \u56523  Dati Completi"\cf5 \strokec5 )\
        st.dataframe(df[[\cf8 \strokec8 'name'\cf5 \strokec5 , \cf8 \strokec8 'platform'\cf5 \strokec5 , \cf8 \strokec8 'spend'\cf5 \strokec5 , \cf8 \strokec8 'revenue'\cf5 \strokec5 , \cf8 \strokec8 'roas'\cf5 \strokec5 , \cf8 \strokec8 'streams'\cf5 \strokec5 , \cf8 \strokec8 'ctr'\cf5 \strokec5 , \cf8 \strokec8 'status'\cf5 \strokec5 ]], \
                    use_container_width\cf7 \strokec7 =\cf9 \strokec9 True\cf5 \strokec5 )\
\
\pard\pardeftab720\partightenfactor0

\f4\i \cf6 \strokec6 # --- AI STRATEGY ROOM ---
\f3\i0 \cf5 \strokec5 \
\pard\pardeftab720\partightenfactor0
\cf3 \strokec3 elif\cf5 \strokec5  nav \cf7 \strokec7 ==\cf5 \strokec5  \cf8 \strokec8 "\uc0\u55357 \u56492  AI Strategy Room"\cf5 \strokec5 :\
    st.title(\cf8 \strokec8 "\uc0\u55358 \u56800  AI Strategy Room"\cf5 \strokec5 )\
    st.caption(\cf8 \strokec8 "\uc0\u55357 \u56510  Memoria Persistente \'95 \u55357 \u56599  Accesso Dati Real-Time"\cf5 \strokec5 )\
    \
    
\f4\i \cf6 \strokec6 # Carica cronologia
\f3\i0 \cf5 \strokec5 \
    \cf3 \strokec3 if\cf5 \strokec5  \cf8 \strokec8 "messages"\cf5 \strokec5  \cf3 \strokec3 not\cf5 \strokec5  \cf3 \strokec3 in\cf5 \strokec5  st.session_state \cf3 \strokec3 or\cf5 \strokec5  \cf8 \strokec8 len\cf5 \strokec5 (st.session_state.messages) \cf7 \strokec7 ==\cf5 \strokec5  \cf9 \strokec9 0\cf5 \strokec5 :\
        history \cf7 \strokec7 =\cf5 \strokec5  load_chat_history()\
        \cf3 \strokec3 if\cf5 \strokec5  \cf3 \strokec3 not\cf5 \strokec5  history:\
            welcome \cf7 \strokec7 =\cf5 \strokec5  \cf8 \strokec8 "Ciao YangKidd. Ho accesso completo ai tuoi dati campagne. Su cosa lavoriamo?"\cf5 \strokec5 \
            st.session_state.messages \cf7 \strokec7 =\cf5 \strokec5  [\{\cf8 \strokec8 "role"\cf5 \strokec5 : \cf8 \strokec8 "assistant"\cf5 \strokec5 , \cf8 \strokec8 "content"\cf5 \strokec5 : welcome\}]\
            save_chat_message(\cf8 \strokec8 "assistant"\cf5 \strokec5 , welcome)\
        \cf3 \strokec3 else\cf5 \strokec5 :\
            st.session_state.messages \cf7 \strokec7 =\cf5 \strokec5  history\
    \
    
\f4\i \cf6 \strokec6 # Mostra chat
\f3\i0 \cf5 \strokec5 \
    \cf3 \strokec3 for\cf5 \strokec5  msg \cf3 \strokec3 in\cf5 \strokec5  st.session_state.messages:\
        \cf3 \strokec3 with\cf5 \strokec5  st.chat_message(msg[\cf8 \strokec8 "role"\cf5 \strokec5 ]):\
            st.markdown(msg[\cf8 \strokec8 "content"\cf5 \strokec5 ])\
    \
    
\f4\i \cf6 \strokec6 # Input
\f3\i0 \cf5 \strokec5 \
    \cf3 \strokec3 if\cf5 \strokec5  prompt \cf7 \strokec7 :=\cf5 \strokec5  st.chat_input(\cf8 \strokec8 "Chiedi strategia, analisi, ottimizzazioni..."\cf5 \strokec5 ):\
        st.session_state.messages.append(\{\cf8 \strokec8 "role"\cf5 \strokec5 : \cf8 \strokec8 "user"\cf5 \strokec5 , \cf8 \strokec8 "content"\cf5 \strokec5 : prompt\})\
        save_chat_message(\cf8 \strokec8 "user"\cf5 \strokec5 , prompt)\
        \
        \cf3 \strokec3 with\cf5 \strokec5  st.chat_message(\cf8 \strokec8 "user"\cf5 \strokec5 ):\
            st.markdown(prompt)\
        \
        \cf3 \strokec3 with\cf5 \strokec5  st.chat_message(\cf8 \strokec8 "assistant"\cf5 \strokec5 ):\
            response_placeholder \cf7 \strokec7 =\cf5 \strokec5  st.empty()\
            full_response \cf7 \strokec7 =\cf5 \strokec5  \cf8 \strokec8 ""\cf5 \strokec5 \
            \
            
\f4\i \cf6 \strokec6 # Carica dati campagne per contesto
\f3\i0 \cf5 \strokec5 \
            campaign_data \cf7 \strokec7 =\cf5 \strokec5  get_campaigns()\
            \
            \cf3 \strokec3 for\cf5 \strokec5  chunk \cf3 \strokec3 in\cf5 \strokec5  generate_contextual_response(st.session_state.messages, campaign_data):\
                full_response \cf7 \strokec7 +=\cf5 \strokec5  chunk\
                response_placeholder.markdown(full_response \cf7 \strokec7 +\cf5 \strokec5  \cf8 \strokec8 "\uc0\u9612 "\cf5 \strokec5 )\
            \
            response_placeholder.markdown(full_response)\
        \
        st.session_state.messages.append(\{\cf8 \strokec8 "role"\cf5 \strokec5 : \cf8 \strokec8 "assistant"\cf5 \strokec5 , \cf8 \strokec8 "content"\cf5 \strokec5 : full_response\})\
        save_chat_message(\cf8 \strokec8 "assistant"\cf5 \strokec5 , full_response, campaign_context\cf7 \strokec7 =\cf5 \strokec5 campaign_data.to_dict(\cf8 \strokec8 'records'\cf5 \strokec5 ))\
    \
    
\f4\i \cf6 \strokec6 # Sidebar per gestione
\f3\i0 \cf5 \strokec5 \
    \cf3 \strokec3 with\cf5 \strokec5  st.sidebar:\
        st.divider()\
        \cf3 \strokec3 if\cf5 \strokec5  st.button(\cf8 \strokec8 "\uc0\u55357 \u56785 \u65039  Nuova Sessione"\cf5 \strokec5 ):\
            st.session_state.messages \cf7 \strokec7 =\cf5 \strokec5  []\
            st.session_state.session_id \cf7 \strokec7 =\cf5 \strokec5  \cf8 \strokec8 f"session_\cf5 \strokec5 \{datetime.now().strftime(\cf8 \strokec8 '%Y%m%d_%H%M%S'\cf5 \strokec5 )\}\cf8 \strokec8 "\cf5 \strokec5 \
            st.rerun()\
\
\pard\pardeftab720\partightenfactor0

\f4\i \cf6 \strokec6 # --- CAMPAIGN MANAGER ---
\f3\i0 \cf5 \strokec5 \
\pard\pardeftab720\partightenfactor0
\cf3 \strokec3 elif\cf5 \strokec5  nav \cf7 \strokec7 ==\cf5 \strokec5  \cf8 \strokec8 "\uc0\u9881 \u65039  Campaign Manager"\cf5 \strokec5 :\
    st.title(\cf8 \strokec8 "\uc0\u9881 \u65039  Campaign Builder Pro"\cf5 \strokec5 )\
    \
    tab1, tab2 \cf7 \strokec7 =\cf5 \strokec5  st.tabs([\cf8 \strokec8 "\uc0\u10133  Nuova Campagna"\cf5 \strokec5 , \cf8 \strokec8 "\uc0\u55357 \u56541  Gestione"\cf5 \strokec5 ])\
    \
    \cf3 \strokec3 with\cf5 \strokec5  tab1:\
        \cf3 \strokec3 with\cf5 \strokec5  st.form(\cf8 \strokec8 "new_campaign"\cf5 \strokec5 ):\
            col1, col2 \cf7 \strokec7 =\cf5 \strokec5  st.columns(\cf9 \strokec9 2\cf5 \strokec5 )\
            \
            name \cf7 \strokec7 =\cf5 \strokec5  col1.text_input(\cf8 \strokec8 "\uc0\u55357 \u56524  Nome Campagna*"\cf5 \strokec5 , placeholder\cf7 \strokec7 =\cf8 \strokec8 "Es: Lancio Singolo 'Strada'"\cf5 \strokec5 )\
            platform \cf7 \strokec7 =\cf5 \strokec5  col2.selectbox(\cf8 \strokec8 "\uc0\u55356 \u57263  Piattaforma*"\cf5 \strokec5 , \
                                     [\cf8 \strokec8 "Meta Ads"\cf5 \strokec5 , \cf8 \strokec8 "TikTok Ads"\cf5 \strokec5 , \cf8 \strokec8 "Spotify Marquee"\cf5 \strokec5 , \cf8 \strokec8 "YouTube Ads"\cf5 \strokec5 , \cf8 \strokec8 "Google Ads"\cf5 \strokec5 ])\
            \
            col3, col4, col5 \cf7 \strokec7 =\cf5 \strokec5  st.columns(\cf9 \strokec9 3\cf5 \strokec5 )\
            budget \cf7 \strokec7 =\cf5 \strokec5  col3.number_input(\cf8 \strokec8 "\uc0\u55357 \u56496  Budget (\'80)"\cf5 \strokec5 , min_value\cf7 \strokec7 =\cf9 \strokec9 0.0\cf5 \strokec5 , value\cf7 \strokec7 =\cf9 \strokec9 500.0\cf5 \strokec5 , step\cf7 \strokec7 =\cf9 \strokec9 50.0\cf5 \strokec5 )\
            spend \cf7 \strokec7 =\cf5 \strokec5  col4.number_input(\cf8 \strokec8 "\uc0\u55357 \u56504  Spesa Effettiva (\'80)"\cf5 \strokec5 , min_value\cf7 \strokec7 =\cf9 \strokec9 0.0\cf5 \strokec5 , value\cf7 \strokec7 =\cf9 \strokec9 450.0\cf5 \strokec5 , step\cf7 \strokec7 =\cf9 \strokec9 10.0\cf5 \strokec5 )\
            revenue \cf7 \strokec7 =\cf5 \strokec5  col5.number_input(\cf8 \strokec8 "\uc0\u55357 \u56520  Revenue/Valore (\'80)"\cf5 \strokec5 , min_value\cf7 \strokec7 =\cf9 \strokec9 0.0\cf5 \strokec5 , value\cf7 \strokec7 =\cf9 \strokec9 900.0\cf5 \strokec5 , step\cf7 \strokec7 =\cf9 \strokec9 50.0\cf5 \strokec5 )\
            \
            st.markdown(\cf8 \strokec8 "#### \uc0\u55357 \u56522  Metriche Performance"\cf5 \strokec5 )\
            col6, col7, col8 \cf7 \strokec7 =\cf5 \strokec5  st.columns(\cf9 \strokec9 3\cf5 \strokec5 )\
            impressions \cf7 \strokec7 =\cf5 \strokec5  col6.number_input(\cf8 \strokec8 "\uc0\u55357 \u56385 \u65039  Impressions"\cf5 \strokec5 , min_value\cf7 \strokec7 =\cf9 \strokec9 0\cf5 \strokec5 , value\cf7 \strokec7 =\cf9 \strokec9 10000\cf5 \strokec5 , step\cf7 \strokec7 =\cf9 \strokec9 1000\cf5 \strokec5 )\
            clicks \cf7 \strokec7 =\cf5 \strokec5  col7.number_input(\cf8 \strokec8 "\uc0\u55357 \u56753 \u65039  Click"\cf5 \strokec5 , min_value\cf7 \strokec7 =\cf9 \strokec9 0\cf5 \strokec5 , value\cf7 \strokec7 =\cf9 \strokec9 250\cf5 \strokec5 , step\cf7 \strokec7 =\cf9 \strokec9 10\cf5 \strokec5 )\
            streams \cf7 \strokec7 =\cf5 \strokec5  col8.number_input(\cf8 \strokec8 "\uc0\u55356 \u57269  Streams"\cf5 \strokec5 , min_value\cf7 \strokec7 =\cf9 \strokec9 0\cf5 \strokec5 , value\cf7 \strokec7 =\cf9 \strokec9 500\cf5 \strokec5 , step\cf7 \strokec7 =\cf9 \strokec9 50\cf5 \strokec5 )\
            \
            col9, col10 \cf7 \strokec7 =\cf5 \strokec5  st.columns(\cf9 \strokec9 2\cf5 \strokec5 )\
            saves \cf7 \strokec7 =\cf5 \strokec5  col9.number_input(\cf8 \strokec8 "\uc0\u55357 \u56510  Saves/Salvataggi"\cf5 \strokec5 , min_value\cf7 \strokec7 =\cf9 \strokec9 0\cf5 \strokec5 , value\cf7 \strokec7 =\cf9 \strokec9 50\cf5 \strokec5 )\
            shares \cf7 \strokec7 =\cf5 \strokec5  col10.number_input(\cf8 \strokec8 "\uc0\u55357 \u56580  Shares/Condivisioni"\cf5 \strokec5 , min_value\cf7 \strokec7 =\cf9 \strokec9 0\cf5 \strokec5 , value\cf7 \strokec7 =\cf9 \strokec9 30\cf5 \strokec5 )\
            \
            st.markdown(\cf8 \strokec8 "#### \uc0\u55356 \u57263  Targeting & Creative"\cf5 \strokec5 )\
            col11, col12 \cf7 \strokec7 =\cf5 \strokec5  st.columns(\cf9 \strokec9 2\cf5 \strokec5 )\
            target_audience \cf7 \strokec7 =\cf5 \strokec5  col11.text_input(\cf8 \strokec8 "\uc0\u55357 \u56421  Target Audience"\cf5 \strokec5 , placeholder\cf7 \strokec7 =\cf8 \strokec8 "Es: Uomini 18-24, Italia, fan trap"\cf5 \strokec5 )\
            creative_type \cf7 \strokec7 =\cf5 \strokec5  col12.selectbox(\cf8 \strokec8 "\uc0\u55356 \u57256  Tipo Creative"\cf5 \strokec5 , \
                                           [\cf8 \strokec8 "Video Vertical"\cf5 \strokec5 , \cf8 \strokec8 "Video 16:9"\cf5 \strokec5 , \cf8 \strokec8 "Carousel"\cf5 \strokec5 , \cf8 \strokec8 "Static Image"\cf5 \strokec5 , \cf8 \strokec8 "Story"\cf5 \strokec5 ])\
            \
            col13, col14 \cf7 \strokec7 =\cf5 \strokec5  st.columns(\cf9 \strokec9 2\cf5 \strokec5 )\
            start_date \cf7 \strokec7 =\cf5 \strokec5  col13.date_input(\cf8 \strokec8 "\uc0\u55357 \u56517  Data Inizio"\cf5 \strokec5 , datetime.now())\
            end_date \cf7 \strokec7 =\cf5 \strokec5  col14.date_input(\cf8 \strokec8 "\uc0\u55357 \u56517  Data Fine"\cf5 \strokec5 , datetime.now() \cf7 \strokec7 +\cf5 \strokec5  timedelta(days\cf7 \strokec7 =\cf9 \strokec9 7\cf5 \strokec5 ))\
            \
            notes \cf7 \strokec7 =\cf5 \strokec5  st.text_area(\cf8 \strokec8 "\uc0\u55357 \u56541  Note"\cf5 \strokec5 , placeholder\cf7 \strokec7 =\cf8 \strokec8 "Osservazioni, test effettuati, insights..."\cf5 \strokec5 )\
            \
            \cf3 \strokec3 if\cf5 \strokec5  st.form_submit_button(\cf8 \strokec8 "\uc0\u55357 \u56510  Salva Campagna"\cf5 \strokec5 , use_container_width\cf7 \strokec7 =\cf9 \strokec9 True\cf5 \strokec5 ):\
                \cf3 \strokec3 if\cf5 \strokec5  \cf3 \strokec3 not\cf5 \strokec5  name:\
                    st.error(\cf8 \strokec8 "\uc0\u9888 \u65039  Il nome \'e8 obbligatorio!"\cf5 \strokec5 )\
                \cf3 \strokec3 else\cf5 \strokec5 :\
                    campaign_data \cf7 \strokec7 =\cf5 \strokec5  \{\
                        \cf8 \strokec8 'name'\cf5 \strokec5 : name, \cf8 \strokec8 'platform'\cf5 \strokec5 : platform, \cf8 \strokec8 'status'\cf5 \strokec5 : \cf8 \strokec8 'Active'\cf5 \strokec5 ,\
                        \cf8 \strokec8 'budget'\cf5 \strokec5 : budget, \cf8 \strokec8 'spend'\cf5 \strokec5 : spend, \cf8 \strokec8 'revenue'\cf5 \strokec5 : revenue,\
                        \cf8 \strokec8 'impressions'\cf5 \strokec5 : impressions, \cf8 \strokec8 'clicks'\cf5 \strokec5 : clicks,\
                        \cf8 \strokec8 'streams'\cf5 \strokec5 : streams, \cf8 \strokec8 'saves'\cf5 \strokec5 : saves, \cf8 \strokec8 'shares'\cf5 \strokec5 : shares,\
                        \cf8 \strokec8 'target_audience'\cf5 \strokec5 : target_audience, \cf8 \strokec8 'creative_type'\cf5 \strokec5 : creative_type,\
                        \cf8 \strokec8 'start_date'\cf5 \strokec5 : \cf8 \strokec8 str\cf5 \strokec5 (start_date), \cf8 \strokec8 'end_date'\cf5 \strokec5 : \cf8 \strokec8 str\cf5 \strokec5 (end_date), \cf8 \strokec8 'notes'\cf5 \strokec5 : notes\
                    \}\
                    save_campaign(campaign_data)\
                    st.success(\cf8 \strokec8 f"\uc0\u9989  Campagna '\cf5 \strokec5 \{name\}\cf8 \strokec8 ' salvata!"\cf5 \strokec5 )\
                    st.balloons()\
                    st.rerun()\
    \
    \cf3 \strokec3 with\cf5 \strokec5  tab2:\
        st.subheader(\cf8 \strokec8 "\uc0\u55357 \u56523  Campagne Attive"\cf5 \strokec5 )\
        df \cf7 \strokec7 =\cf5 \strokec5  get_campaigns()\
        \
        \cf3 \strokec3 if\cf5 \strokec5  df.empty:\
            st.info(\cf8 \strokec8 "Nessuna campagna salvata."\cf5 \strokec5 )\
        \cf3 \strokec3 else\cf5 \strokec5 :\
            \cf3 \strokec3 for\cf5 \strokec5  idx, row \cf3 \strokec3 in\cf5 \strokec5  df.iterrows():\
                \cf3 \strokec3 with\cf5 \strokec5  st.expander(\cf8 \strokec8 f"\uc0\u55357 \u56524  \cf5 \strokec5 \{row[\cf8 \strokec8 'name'\cf5 \strokec5 ]\}\cf8 \strokec8  - \cf5 \strokec5 \{row[\cf8 \strokec8 'platform'\cf5 \strokec5 ]\}\cf8 \strokec8  (ROAS: \cf5 \strokec5 \{row[\cf8 \strokec8 'roas'\cf5 \strokec5 ]:.2f\}\cf8 \strokec8 x)"\cf5 \strokec5 ):\
                    col_a, col_b, col_c \cf7 \strokec7 =\cf5 \strokec5  st.columns(\cf9 \strokec9 3\cf5 \strokec5 )\
                    col_a.metric(\cf8 \strokec8 "\uc0\u55357 \u56504  Spend"\cf5 \strokec5 , \cf8 \strokec8 f"\'80\cf5 \strokec5 \{row[\cf8 \strokec8 'spend'\cf5 \strokec5 ]:.0f\}\cf8 \strokec8 "\cf5 \strokec5 )\
                    col_b.metric(\cf8 \strokec8 "\uc0\u55357 \u56520  Revenue"\cf5 \strokec5 , \cf8 \strokec8 f"\'80\cf5 \strokec5 \{row[\cf8 \strokec8 'revenue'\cf5 \strokec5 ]:.0f\}\cf8 \strokec8 "\cf5 \strokec5 )\
                    col_c.metric(\cf8 \strokec8 "\uc0\u55356 \u57263  ROAS"\cf5 \strokec5 , \cf8 \strokec8 f"\cf5 \strokec5 \{row[\cf8 \strokec8 'roas'\cf5 \strokec5 ]:.2f\}\cf8 \strokec8 x"\cf5 \strokec5 )\
                    \
                    col_d, col_e, col_f \cf7 \strokec7 =\cf5 \strokec5  st.columns(\cf9 \strokec9 3\cf5 \strokec5 )\
                    col_d.metric(\cf8 \strokec8 "\uc0\u55357 \u56385 \u65039  Impressions"\cf5 \strokec5 , \cf8 \strokec8 f"\cf5 \strokec5 \{row[\cf8 \strokec8 'impressions'\cf5 \strokec5 ]:,\}\cf8 \strokec8 "\cf5 \strokec5 )\
                    col_e.metric(\cf8 \strokec8 "\uc0\u55357 \u56753 \u65039  CTR"\cf5 \strokec5 , \cf8 \strokec8 f"\cf5 \strokec5 \{row[\cf8 \strokec8 'ctr'\cf5 \strokec5 ]:.2f\}\cf8 \strokec8 %"\cf5 \strokec5 )\
                    col_f.metric(\cf8 \strokec8 "\uc0\u55356 \u57269  Streams"\cf5 \strokec5 , \cf8 \strokec8 f"\cf5 \strokec5 \{row[\cf8 \strokec8 'streams'\cf5 \strokec5 ]:,\}\cf8 \strokec8 "\cf5 \strokec5 )\
                    \
                    st.markdown(\cf8 \strokec8 f"**Target:** \cf5 \strokec5 \{row[\cf8 \strokec8 'target_audience'\cf5 \strokec5 ]\}\cf8 \strokec8 "\cf5 \strokec5 )\
                    st.markdown(\cf8 \strokec8 f"**Creative:** \cf5 \strokec5 \{row[\cf8 \strokec8 'creative_type'\cf5 \strokec5 ]\}\cf8 \strokec8 "\cf5 \strokec5 )\
                    \cf3 \strokec3 if\cf5 \strokec5  row[\cf8 \strokec8 'notes'\cf5 \strokec5 ]:\
                        st.markdown(\cf8 \strokec8 f"**Note:** \cf5 \strokec5 \{row[\cf8 \strokec8 'notes'\cf5 \strokec5 ]\}\cf8 \strokec8 "\cf5 \strokec5 )\
                    \
                    \cf3 \strokec3 if\cf5 \strokec5  st.button(\cf8 \strokec8 f"\uc0\u55357 \u56785 \u65039  Elimina"\cf5 \strokec5 , key\cf7 \strokec7 =\cf8 \strokec8 f"del_\cf5 \strokec5 \{row[\cf8 \strokec8 'id'\cf5 \strokec5 ]\}\cf8 \strokec8 "\cf5 \strokec5 ):\
                        delete_campaign(row[\cf8 \strokec8 'id'\cf5 \strokec5 ])\
                        st.success(\cf8 \strokec8 "Campagna eliminata!"\cf5 \strokec5 )\
                        st.rerun()\
\
\pard\pardeftab720\partightenfactor0

\f4\i \cf6 \strokec6 # --- API MANAGER ---
\f3\i0 \cf5 \strokec5 \
\pard\pardeftab720\partightenfactor0
\cf3 \strokec3 elif\cf5 \strokec5  nav \cf7 \strokec7 ==\cf5 \strokec5  \cf8 \strokec8 "\uc0\u55357 \u56588  API Manager"\cf5 \strokec5 :\
    st.title(\cf8 \strokec8 "\uc0\u55357 \u56588  Social Media API Integration"\cf5 \strokec5 )\
    st.caption(\cf8 \strokec8 "Connetti i tuoi profili per dati automatici"\cf5 \strokec5 )\
    \
    tab_spotify, tab_instagram, tab_youtube, tab_tiktok \cf7 \strokec7 =\cf5 \strokec5  st.tabs([\cf8 \strokec8 "\uc0\u55356 \u57269  Spotify"\cf5 \strokec5 , \cf8 \strokec8 "\uc0\u55357 \u56568  Instagram"\cf5 \strokec5 , \cf8 \strokec8 "\uc0\u9654 \u65039  YouTube"\cf5 \strokec5 , \cf8 \strokec8 "\uc0\u55356 \u57260  TikTok"\cf5 \strokec5 ])\
    \
    
\f4\i \cf6 \strokec6 # --- SPOTIFY ---
\f3\i0 \cf5 \strokec5 \
    \cf3 \strokec3 with\cf5 \strokec5  tab_spotify:\
        st.subheader(\cf8 \strokec8 "\uc0\u55356 \u57269  Spotify for Artists"\cf5 \strokec5 )\
        \
        spotify_api \cf7 \strokec7 =\cf5 \strokec5  SpotifyAPI()\
        \
        \cf3 \strokec3 with\cf5 \strokec5  st.expander(\cf8 \strokec8 "\uc0\u9881 \u65039  Configurazione API"\cf5 \strokec5 ):\
            st.markdown(\cf8 \strokec8 """\
\pard\pardeftab720\partightenfactor0
\cf5 \strokec5             **Step per ottenere credenziali:**\
            1. Vai su [Spotify Developer Dashboard](https://developer.spotify.com/dashboard)\
            2. Crea una nuova App\
            3. Aggiungi `http://localhost:8501` come Redirect URI\
            4. Copia Client ID e Client Secret\
\pard\pardeftab720\partightenfactor0
\cf8 \strokec8             """\cf5 \strokec5 )\
            \
            col1, col2 \cf7 \strokec7 =\cf5 \strokec5  st.columns(\cf9 \strokec9 2\cf5 \strokec5 )\
            client_id \cf7 \strokec7 =\cf5 \strokec5  col1.text_input(\cf8 \strokec8 "Client ID"\cf5 \strokec5 , \cf8 \strokec8 type\cf7 \strokec7 =\cf8 \strokec8 "password"\cf5 \strokec5 , key\cf7 \strokec7 =\cf8 \strokec8 "spotify_id"\cf5 \strokec5 )\
            client_secret \cf7 \strokec7 =\cf5 \strokec5  col2.text_input(\cf8 \strokec8 "Client Secret"\cf5 \strokec5 , \cf8 \strokec8 type\cf7 \strokec7 =\cf8 \strokec8 "password"\cf5 \strokec5 , key\cf7 \strokec7 =\cf8 \strokec8 "spotify_secret"\cf5 \strokec5 )\
            \
            \cf3 \strokec3 if\cf5 \strokec5  st.button(\cf8 \strokec8 "\uc0\u55357 \u56510  Salva Credenziali Spotify"\cf5 \strokec5 ):\
                \cf3 \strokec3 if\cf5 \strokec5  client_id \cf3 \strokec3 and\cf5 \strokec5  client_secret:\
                    
\f4\i \cf6 \strokec6 # Genera URL autorizzazione
\f3\i0 \cf5 \strokec5 \
                    auth_url \cf7 \strokec7 =\cf5 \strokec5  spotify_api.get_auth_url(client_id, \cf8 \strokec8 "http://localhost:8501"\cf5 \strokec5 )\
                    st.success(\cf8 \strokec8 "\uc0\u9989  Credenziali salvate!"\cf5 \strokec5 )\
                    st.info(\cf8 \strokec8 f"\uc0\u55357 \u56599  Autorizza l'app: \cf5 \strokec5 \{auth_url\}\cf8 \strokec8 "\cf5 \strokec5 )\
                \cf3 \strokec3 else\cf5 \strokec5 :\
                    st.error(\cf8 \strokec8 "\uc0\u9888 \u65039  Compila entrambi i campi!"\cf5 \strokec5 )\
        \
        st.divider()\
        \
        
\f4\i \cf6 \strokec6 # Recupera dati artista
\f3\i0 \cf5 \strokec5 \
        artist_id \cf7 \strokec7 =\cf5 \strokec5  st.text_input(\cf8 \strokec8 "\uc0\u55356 \u57252  Spotify Artist ID"\cf5 \strokec5 , placeholder\cf7 \strokec7 =\cf8 \strokec8 "Es: 3TVXtAsR1Inumwj472S9r4"\cf5 \strokec5 )\
        \
        \cf3 \strokec3 if\cf5 \strokec5  st.button(\cf8 \strokec8 "\uc0\u55357 \u56522  Recupera Statistiche Spotify"\cf5 \strokec5 ):\
            \cf3 \strokec3 if\cf5 \strokec5  artist_id:\
                \cf3 \strokec3 with\cf5 \strokec5  st.spinner(\cf8 \strokec8 "Caricamento dati Spotify..."\cf5 \strokec5 ):\
                    stats \cf7 \strokec7 =\cf5 \strokec5  spotify_api.get_artist_stats(artist_id)\
                    \
                    \cf3 \strokec3 if\cf5 \strokec5  \cf8 \strokec8 'error'\cf5 \strokec5  \cf3 \strokec3 not\cf5 \strokec5  \cf3 \strokec3 in\cf5 \strokec5  stats:\
                        col1, col2, col3 \cf7 \strokec7 =\cf5 \strokec5  st.columns(\cf9 \strokec9 3\cf5 \strokec5 )\
                        col1.metric(\cf8 \strokec8 "\uc0\u55357 \u56421  Followers"\cf5 \strokec5 , \cf8 \strokec8 f"\cf5 \strokec5 \{stats[\cf8 \strokec8 'followers'\cf5 \strokec5 ]:,\}\cf8 \strokec8 "\cf5 \strokec5 )\
                        col2.metric(\cf8 \strokec8 "\uc0\u55357 \u56613  Popularity"\cf5 \strokec5 , \cf8 \strokec8 f"\cf5 \strokec5 \{stats[\cf8 \strokec8 'popularity'\cf5 \strokec5 ]\}\cf8 \strokec8 /100"\cf5 \strokec5 )\
                        col3.metric(\cf8 \strokec8 "\uc0\u55356 \u57269  Top Tracks"\cf5 \strokec5 , \cf8 \strokec8 len\cf5 \strokec5 (stats.get(\cf8 \strokec8 'top_tracks'\cf5 \strokec5 , [])))\
                        \
                        st.success(\cf8 \strokec8 f"\uc0\u9989  Artista: **\cf5 \strokec5 \{stats[\cf8 \strokec8 'name'\cf5 \strokec5 ]\}\cf8 \strokec8 **"\cf5 \strokec5 )\
                        st.write(\cf8 \strokec8 "**Generi:**"\cf5 \strokec5 , \cf8 \strokec8 ", "\cf5 \strokec5 .join(stats.get(\cf8 \strokec8 'genres'\cf5 \strokec5 , [])))\
                        \
                        \cf3 \strokec3 if\cf5 \strokec5  stats.get(\cf8 \strokec8 'top_tracks'\cf5 \strokec5 ):\
                            st.markdown(\cf8 \strokec8 "#### \uc0\u55356 \u57269  Top 5 Tracce"\cf5 \strokec5 )\
                            \cf3 \strokec3 for\cf5 \strokec5  track \cf3 \strokec3 in\cf5 \strokec5  stats[\cf8 \strokec8 'top_tracks'\cf5 \strokec5 ]:\
                                st.write(\cf8 \strokec8 f"\'95 \cf5 \strokec5 \{track[\cf8 \strokec8 'name'\cf5 \strokec5 ]\}\cf8 \strokec8  - \cf5 \strokec5 \{track[\cf8 \strokec8 'popularity'\cf5 \strokec5 ]\}\cf8 \strokec8 /100"\cf5 \strokec5 )\
                        \
                        
\f4\i \cf6 \strokec6 # Salva nel DB
\f3\i0 \cf5 \strokec5 \
                        save_platform_stats(\cf8 \strokec8 'spotify'\cf5 \strokec5 , \{\
                            \cf8 \strokec8 'followers'\cf5 \strokec5 : stats[\cf8 \strokec8 'followers'\cf5 \strokec5 ],\
                            \cf8 \strokec8 'popularity'\cf5 \strokec5 : stats[\cf8 \strokec8 'popularity'\cf5 \strokec5 ]\
                        \})\
                    \cf3 \strokec3 else\cf5 \strokec5 :\
                        st.error(\cf8 \strokec8 f"\uc0\u10060  \cf5 \strokec5 \{stats[\cf8 \strokec8 'error'\cf5 \strokec5 ]\}\cf8 \strokec8 "\cf5 \strokec5 )\
            \cf3 \strokec3 else\cf5 \strokec5 :\
                st.warning(\cf8 \strokec8 "\uc0\u9888 \u65039  Inserisci un Artist ID"\cf5 \strokec5 )\
    \
    
\f4\i \cf6 \strokec6 # --- INSTAGRAM ---
\f3\i0 \cf5 \strokec5 \
    \cf3 \strokec3 with\cf5 \strokec5  tab_instagram:\
        st.subheader(\cf8 \strokec8 "\uc0\u55357 \u56568  Instagram Business"\cf5 \strokec5 )\
        \
        instagram_api \cf7 \strokec7 =\cf5 \strokec5  InstagramAPI()\
        \
        \cf3 \strokec3 with\cf5 \strokec5  st.expander(\cf8 \strokec8 "\uc0\u9881 \u65039  Configurazione API"\cf5 \strokec5 ):\
            st.markdown(\cf8 \strokec8 """\
\pard\pardeftab720\partightenfactor0
\cf5 \strokec5             **Requisiti:**\
            1. Account Instagram Business/Creator\
            2. Pagina Facebook collegata\
            3. Vai su [Facebook Developers](https://developers.facebook.com/)\
            4. Crea App e ottieni Access Token (Graph API)\
\pard\pardeftab720\partightenfactor0
\cf8 \strokec8             """\cf5 \strokec5 )\
            \
            access_token \cf7 \strokec7 =\cf5 \strokec5  st.text_input(\cf8 \strokec8 "Access Token"\cf5 \strokec5 , \cf8 \strokec8 type\cf7 \strokec7 =\cf8 \strokec8 "password"\cf5 \strokec5 , key\cf7 \strokec7 =\cf8 \strokec8 "ig_token"\cf5 \strokec5 )\
            \
            \cf3 \strokec3 if\cf5 \strokec5  st.button(\cf8 \strokec8 "\uc0\u55357 \u56510  Salva Token Instagram"\cf5 \strokec5 ):\
                \cf3 \strokec3 if\cf5 \strokec5  access_token:\
                    instagram_api.save_access_token(access_token)\
                    st.success(\cf8 \strokec8 "\uc0\u9989  Token salvato!"\cf5 \strokec5 )\
                \cf3 \strokec3 else\cf5 \strokec5 :\
                    st.error(\cf8 \strokec8 "\uc0\u9888 \u65039  Inserisci il token!"\cf5 \strokec5 )\
        \
        st.divider()\
        \
        user_id \cf7 \strokec7 =\cf5 \strokec5  st.text_input(\cf8 \strokec8 "\uc0\u55357 \u56420  Instagram User ID"\cf5 \strokec5 , placeholder\cf7 \strokec7 =\cf8 \strokec8 "Es: 17841405793187218"\cf5 \strokec5 )\
        \
        col_a, col_b \cf7 \strokec7 =\cf5 \strokec5  st.columns(\cf9 \strokec9 2\cf5 \strokec5 )\
        \
        \cf3 \strokec3 if\cf5 \strokec5  col_a.button(\cf8 \strokec8 "\uc0\u55357 \u56522  Dati Account"\cf5 \strokec5 ):\
            \cf3 \strokec3 if\cf5 \strokec5  user_id:\
                \cf3 \strokec3 with\cf5 \strokec5  st.spinner(\cf8 \strokec8 "Caricamento dati Instagram..."\cf5 \strokec5 ):\
                    data \cf7 \strokec7 =\cf5 \strokec5  instagram_api.get_account_insights(user_id)\
                    \
                    \cf3 \strokec3 if\cf5 \strokec5  \cf8 \strokec8 'error'\cf5 \strokec5  \cf3 \strokec3 not\cf5 \strokec5  \cf3 \strokec3 in\cf5 \strokec5  data:\
                        col1, col2, col3 \cf7 \strokec7 =\cf5 \strokec5  st.columns(\cf9 \strokec9 3\cf5 \strokec5 )\
                        col1.metric(\cf8 \strokec8 "\uc0\u55357 \u56421  Followers"\cf5 \strokec5 , \cf8 \strokec8 f"\cf5 \strokec5 \{data.get(\cf8 \strokec8 'followers_count'\cf5 \strokec5 , \cf9 \strokec9 0\cf5 \strokec5 ):,\}\cf8 \strokec8 "\cf5 \strokec5 )\
                        col2.metric(\cf8 \strokec8 "\uc0\u55357 \u56568  Media"\cf5 \strokec5 , data.get(\cf8 \strokec8 'media_count'\cf5 \strokec5 , \cf9 \strokec9 0\cf5 \strokec5 ))\
                        col3.metric(\cf8 \strokec8 "\uc0\u55357 \u56420  Username"\cf5 \strokec5 , data.get(\cf8 \strokec8 'username'\cf5 \strokec5 , \cf8 \strokec8 'N/A'\cf5 \strokec5 ))\
                        \
                        save_platform_stats(\cf8 \strokec8 'instagram'\cf5 \strokec5 , \{\
                            \cf8 \strokec8 'followers'\cf5 \strokec5 : data.get(\cf8 \strokec8 'followers_count'\cf5 \strokec5 , \cf9 \strokec9 0\cf5 \strokec5 ),\
                            \cf8 \strokec8 'media_count'\cf5 \strokec5 : data.get(\cf8 \strokec8 'media_count'\cf5 \strokec5 , \cf9 \strokec9 0\cf5 \strokec5 )\
                        \})\
                    \cf3 \strokec3 else\cf5 \strokec5 :\
                        st.error(\cf8 \strokec8 f"\uc0\u10060  \cf5 \strokec5 \{data[\cf8 \strokec8 'error'\cf5 \strokec5 ]\}\cf8 \strokec8 "\cf5 \strokec5 )\
        \
        \cf3 \strokec3 if\cf5 \strokec5  col_b.button(\cf8 \strokec8 "\uc0\u55357 \u56520  Engagement Ultimi Post"\cf5 \strokec5 ):\
            \cf3 \strokec3 if\cf5 \strokec5  user_id:\
                \cf3 \strokec3 with\cf5 \strokec5  st.spinner(\cf8 \strokec8 "Analizzando engagement..."\cf5 \strokec5 ):\
                    data \cf7 \strokec7 =\cf5 \strokec5  instagram_api.get_media_insights(user_id)\
                    \
                    \cf3 \strokec3 if\cf5 \strokec5  \cf8 \strokec8 'error'\cf5 \strokec5  \cf3 \strokec3 not\cf5 \strokec5  \cf3 \strokec3 in\cf5 \strokec5  data:\
                        col1, col2, col3 \cf7 \strokec7 =\cf5 \strokec5  st.columns(\cf9 \strokec9 3\cf5 \strokec5 )\
                        col1.metric(\cf8 \strokec8 "\uc0\u10084 \u65039  Likes Totali"\cf5 \strokec5 , \cf8 \strokec8 f"\cf5 \strokec5 \{data[\cf8 \strokec8 'total_likes'\cf5 \strokec5 ]:,\}\cf8 \strokec8 "\cf5 \strokec5 )\
                        col2.metric(\cf8 \strokec8 "\uc0\u55357 \u56492  Commenti Totali"\cf5 \strokec5 , \cf8 \strokec8 f"\cf5 \strokec5 \{data[\cf8 \strokec8 'total_comments'\cf5 \strokec5 ]:,\}\cf8 \strokec8 "\cf5 \strokec5 )\
                        col3.metric(\cf8 \strokec8 "\uc0\u55357 \u56522  Engagement Medio"\cf5 \strokec5 , \cf8 \strokec8 f"\cf5 \strokec5 \{data[\cf8 \strokec8 'avg_engagement'\cf5 \strokec5 ]:.1f\}\cf8 \strokec8 "\cf5 \strokec5 )\
                        \
                        st.success(\cf8 \strokec8 f"\uc0\u9989  Analizzati \cf5 \strokec5 \{data[\cf8 \strokec8 'total_posts'\cf5 \strokec5 ]\}\cf8 \strokec8  post recenti"\cf5 \strokec5 )\
                    \cf3 \strokec3 else\cf5 \strokec5 :\
                        st.error(\cf8 \strokec8 f"\uc0\u10060  \cf5 \strokec5 \{data[\cf8 \strokec8 'error'\cf5 \strokec5 ]\}\cf8 \strokec8 "\cf5 \strokec5 )\
    \
    
\f4\i \cf6 \strokec6 # --- YOUTUBE ---
\f3\i0 \cf5 \strokec5 \
    \cf3 \strokec3 with\cf5 \strokec5  tab_youtube:\
        st.subheader(\cf8 \strokec8 "\uc0\u9654 \u65039  YouTube Analytics"\cf5 \strokec5 )\
        \
        youtube_api \cf7 \strokec7 =\cf5 \strokec5  YouTubeAPI()\
        \
        \cf3 \strokec3 with\cf5 \strokec5  st.expander(\cf8 \strokec8 "\uc0\u9881 \u65039  Configurazione API"\cf5 \strokec5 ):\
            st.markdown(\cf8 \strokec8 """\
\pard\pardeftab720\partightenfactor0
\cf5 \strokec5             **Step:**\
            1. Vai su [Google Cloud Console](https://console.cloud.google.com/)\
            2. Crea progetto e abilita YouTube Data API v3\
            3. Crea credenziali (API Key)\
            4. Copia la chiave\
\pard\pardeftab720\partightenfactor0
\cf8 \strokec8             """\cf5 \strokec5 )\
            \
            api_key \cf7 \strokec7 =\cf5 \strokec5  st.text_input(\cf8 \strokec8 "API Key"\cf5 \strokec5 , \cf8 \strokec8 type\cf7 \strokec7 =\cf8 \strokec8 "password"\cf5 \strokec5 , key\cf7 \strokec7 =\cf8 \strokec8 "yt_key"\cf5 \strokec5 )\
            \
            \cf3 \strokec3 if\cf5 \strokec5  st.button(\cf8 \strokec8 "\uc0\u55357 \u56510  Salva API Key YouTube"\cf5 \strokec5 ):\
                \cf3 \strokec3 if\cf5 \strokec5  api_key:\
                    youtube_api.save_api_key(api_key)\
                    st.success(\cf8 \strokec8 "\uc0\u9989  API Key salvata!"\cf5 \strokec5 )\
                \cf3 \strokec3 else\cf5 \strokec5 :\
                    st.error(\cf8 \strokec8 "\uc0\u9888 \u65039  Inserisci la chiave!"\cf5 \strokec5 )\
        \
        st.divider()\
        \
        tab_channel, tab_video \cf7 \strokec7 =\cf5 \strokec5  st.tabs([\cf8 \strokec8 "\uc0\u55357 \u56570  Canale"\cf5 \strokec5 , \cf8 \strokec8 "\uc0\u55356 \u57253  Video"\cf5 \strokec5 ])\
        \
        \cf3 \strokec3 with\cf5 \strokec5  tab_channel:\
            channel_id \cf7 \strokec7 =\cf5 \strokec5  st.text_input(\cf8 \strokec8 "\uc0\u55357 \u56570  Channel ID"\cf5 \strokec5 , placeholder\cf7 \strokec7 =\cf8 \strokec8 "Es: UCxxxxxxxxxxxxxxxxxx"\cf5 \strokec5 )\
            \
            \cf3 \strokec3 if\cf5 \strokec5  st.button(\cf8 \strokec8 "\uc0\u55357 \u56522  Statistiche Canale"\cf5 \strokec5 ):\
                \cf3 \strokec3 if\cf5 \strokec5  channel_id:\
                    \cf3 \strokec3 with\cf5 \strokec5  st.spinner(\cf8 \strokec8 "Caricamento dati YouTube..."\cf5 \strokec5 ):\
                        data \cf7 \strokec7 =\cf5 \strokec5  youtube_api.get_channel_stats(channel_id)\
                        \
                        \cf3 \strokec3 if\cf5 \strokec5  \cf8 \strokec8 'error'\cf5 \strokec5  \cf3 \strokec3 not\cf5 \strokec5  \cf3 \strokec3 in\cf5 \strokec5  data:\
                            st.success(\cf8 \strokec8 f"\uc0\u9989  Canale: **\cf5 \strokec5 \{data[\cf8 \strokec8 'channel_name'\cf5 \strokec5 ]\}\cf8 \strokec8 **"\cf5 \strokec5 )\
                            \
                            col1, col2, col3 \cf7 \strokec7 =\cf5 \strokec5  st.columns(\cf9 \strokec9 3\cf5 \strokec5 )\
                            col1.metric(\cf8 \strokec8 "\uc0\u55357 \u56421  Iscritti"\cf5 \strokec5 , \cf8 \strokec8 f"\cf5 \strokec5 \{data[\cf8 \strokec8 'subscribers'\cf5 \strokec5 ]:,\}\cf8 \strokec8 "\cf5 \strokec5 )\
                            col2.metric(\cf8 \strokec8 "\uc0\u55357 \u56385 \u65039  Visualizzazioni Totali"\cf5 \strokec5 , \cf8 \strokec8 f"\cf5 \strokec5 \{data[\cf8 \strokec8 'total_views'\cf5 \strokec5 ]:,\}\cf8 \strokec8 "\cf5 \strokec5 )\
                            col3.metric(\cf8 \strokec8 "\uc0\u55356 \u57253  Video"\cf5 \strokec5 , data[\cf8 \strokec8 'video_count'\cf5 \strokec5 ])\
                            \
                            save_platform_stats(\cf8 \strokec8 'youtube'\cf5 \strokec5 , \{\
                                \cf8 \strokec8 'subscribers'\cf5 \strokec5 : data[\cf8 \strokec8 'subscribers'\cf5 \strokec5 ],\
                                \cf8 \strokec8 'total_views'\cf5 \strokec5 : data[\cf8 \strokec8 'total_views'\cf5 \strokec5 ],\
                                \cf8 \strokec8 'video_count'\cf5 \strokec5 : data[\cf8 \strokec8 'video_count'\cf5 \strokec5 ]\
                            \})\
                        \cf3 \strokec3 else\cf5 \strokec5 :\
                            st.error(\cf8 \strokec8 f"\uc0\u10060  \cf5 \strokec5 \{data[\cf8 \strokec8 'error'\cf5 \strokec5 ]\}\cf8 \strokec8 "\cf5 \strokec5 )\
        \
        \cf3 \strokec3 with\cf5 \strokec5  tab_video:\
            video_id \cf7 \strokec7 =\cf5 \strokec5  st.text_input(\cf8 \strokec8 "\uc0\u55356 \u57253  Video ID"\cf5 \strokec5 , placeholder\cf7 \strokec7 =\cf8 \strokec8 "Es: dQw4w9WgXcQ"\cf5 \strokec5 )\
            \
            \cf3 \strokec3 if\cf5 \strokec5  st.button(\cf8 \strokec8 "\uc0\u55357 \u56522  Statistiche Video"\cf5 \strokec5 ):\
                \cf3 \strokec3 if\cf5 \strokec5  video_id:\
                    \cf3 \strokec3 with\cf5 \strokec5  st.spinner(\cf8 \strokec8 "Caricamento dati video..."\cf5 \strokec5 ):\
                        data \cf7 \strokec7 =\cf5 \strokec5  youtube_api.get_video_stats(video_id)\
                        \
                        \cf3 \strokec3 if\cf5 \strokec5  \cf8 \strokec8 'error'\cf5 \strokec5  \cf3 \strokec3 not\cf5 \strokec5  \cf3 \strokec3 in\cf5 \strokec5  data:\
                            st.success(\cf8 \strokec8 f"\uc0\u9989  Video: **\cf5 \strokec5 \{data[\cf8 \strokec8 'title'\cf5 \strokec5 ]\}\cf8 \strokec8 **"\cf5 \strokec5 )\
                            \
                            col1, col2, col3 \cf7 \strokec7 =\cf5 \strokec5  st.columns(\cf9 \strokec9 3\cf5 \strokec5 )\
                            col1.metric(\cf8 \strokec8 "\uc0\u55357 \u56385 \u65039  Views"\cf5 \strokec5 , \cf8 \strokec8 f"\cf5 \strokec5 \{data[\cf8 \strokec8 'views'\cf5 \strokec5 ]:,\}\cf8 \strokec8 "\cf5 \strokec5 )\
                            col2.metric(\cf8 \strokec8 "\uc0\u55357 \u56397  Likes"\cf5 \strokec5 , \cf8 \strokec8 f"\cf5 \strokec5 \{data[\cf8 \strokec8 'likes'\cf5 \strokec5 ]:,\}\cf8 \strokec8 "\cf5 \strokec5 )\
                            col3.metric(\cf8 \strokec8 "\uc0\u55357 \u56492  Commenti"\cf5 \strokec5 , \cf8 \strokec8 f"\cf5 \strokec5 \{data[\cf8 \strokec8 'comments'\cf5 \strokec5 ]:,\}\cf8 \strokec8 "\cf5 \strokec5 )\
                            \
                            st.caption(\cf8 \strokec8 f"\uc0\u55357 \u56517  Pubblicato: \cf5 \strokec5 \{data[\cf8 \strokec8 'published_at'\cf5 \strokec5 ]\}\cf8 \strokec8 "\cf5 \strokec5 )\
                        \cf3 \strokec3 else\cf5 \strokec5 :\
                            st.error(\cf8 \strokec8 f"\uc0\u10060  \cf5 \strokec5 \{data[\cf8 \strokec8 'error'\cf5 \strokec5 ]\}\cf8 \strokec8 "\cf5 \strokec5 )\
    \
    
\f4\i \cf6 \strokec6 # --- TIKTOK ---
\f3\i0 \cf5 \strokec5 \
    \cf3 \strokec3 with\cf5 \strokec5  tab_tiktok:\
        st.subheader(\cf8 \strokec8 "\uc0\u55356 \u57260  TikTok Analytics"\cf5 \strokec5 )\
        \
        st.warning(\cf8 \strokec8 """\
\pard\pardeftab720\partightenfactor0
\cf5 \strokec5         \uc0\u9888 \u65039  **TikTok API Limitata**\
        \
        L'API ufficiale richiede:\
        - Account TikTok for Business approvato\
        - Processo di approval lungo\
        \
        **Alternativa:** Import manuale dati da TikTok Analytics\
\pard\pardeftab720\partightenfactor0
\cf8 \strokec8         """\cf5 \strokec5 )\
        \
        st.markdown(\cf8 \strokec8 "#### \uc0\u55357 \u56522  Import Manuale Dati"\cf5 \strokec5 )\
        \
        col1, col2, col3 \cf7 \strokec7 =\cf5 \strokec5  st.columns(\cf9 \strokec9 3\cf5 \strokec5 )\
        followers \cf7 \strokec7 =\cf5 \strokec5  col1.number_input(\cf8 \strokec8 "\uc0\u55357 \u56421  Followers"\cf5 \strokec5 , min_value\cf7 \strokec7 =\cf9 \strokec9 0\cf5 \strokec5 , value\cf7 \strokec7 =\cf9 \strokec9 0\cf5 \strokec5 )\
        total_likes \cf7 \strokec7 =\cf5 \strokec5  col2.number_input(\cf8 \strokec8 "\uc0\u10084 \u65039  Likes Totali"\cf5 \strokec5 , min_value\cf7 \strokec7 =\cf9 \strokec9 0\cf5 \strokec5 , value\cf7 \strokec7 =\cf9 \strokec9 0\cf5 \strokec5 )\
        total_views \cf7 \strokec7 =\cf5 \strokec5  col3.number_input(\cf8 \strokec8 "\uc0\u55357 \u56385 \u65039  Views Totali"\cf5 \strokec5 , min_value\cf7 \strokec7 =\cf9 \strokec9 0\cf5 \strokec5 , value\cf7 \strokec7 =\cf9 \strokec9 0\cf5 \strokec5 )\
        \
        col4, col5 \cf7 \strokec7 =\cf5 \strokec5  st.columns(\cf9 \strokec9 2\cf5 \strokec5 )\
        avg_engagement \cf7 \strokec7 =\cf5 \strokec5  col4.number_input(\cf8 \strokec8 "\uc0\u55357 \u56522  Engagement Rate %"\cf5 \strokec5 , min_value\cf7 \strokec7 =\cf9 \strokec9 0.0\cf5 \strokec5 , max_value\cf7 \strokec7 =\cf9 \strokec9 100.0\cf5 \strokec5 , value\cf7 \strokec7 =\cf9 \strokec9 0.0\cf5 \strokec5 , step\cf7 \strokec7 =\cf9 \strokec9 0.1\cf5 \strokec5 )\
        video_count \cf7 \strokec7 =\cf5 \strokec5  col5.number_input(\cf8 \strokec8 "\uc0\u55356 \u57253  Video Pubblicati"\cf5 \strokec5 , min_value\cf7 \strokec7 =\cf9 \strokec9 0\cf5 \strokec5 , value\cf7 \strokec7 =\cf9 \strokec9 0\cf5 \strokec5 )\
        \
        \cf3 \strokec3 if\cf5 \strokec5  st.button(\cf8 \strokec8 "\uc0\u55357 \u56510  Salva Dati TikTok"\cf5 \strokec5 ):\
            tiktok_data \cf7 \strokec7 =\cf5 \strokec5  \{\
                \cf8 \strokec8 'followers'\cf5 \strokec5 : followers,\
                \cf8 \strokec8 'total_likes'\cf5 \strokec5 : total_likes,\
                \cf8 \strokec8 'total_views'\cf5 \strokec5 : total_views,\
                \cf8 \strokec8 'avg_engagement'\cf5 \strokec5 : avg_engagement,\
                \cf8 \strokec8 'video_count'\cf5 \strokec5 : video_count\
            \}\
            \
            tiktok_api \cf7 \strokec7 =\cf5 \strokec5  TikTokAPI()\
            result \cf7 \strokec7 =\cf5 \strokec5  tiktok_api.manual_import(tiktok_data)\
            \
            save_platform_stats(\cf8 \strokec8 'tiktok'\cf5 \strokec5 , tiktok_data)\
            \
            st.success(\cf8 \strokec8 "\uc0\u9989  Dati TikTok salvati!"\cf5 \strokec5 )\
    \
    
\f4\i \cf6 \strokec6 # --- STORICO DATI ---
\f3\i0 \cf5 \strokec5 \
    st.divider()\
    st.subheader(\cf8 \strokec8 "\uc0\u55357 \u56520  Storico Dati Piattaforme"\cf5 \strokec5 )\
    \
    platform_filter \cf7 \strokec7 =\cf5 \strokec5  st.selectbox(\cf8 \strokec8 "Seleziona Piattaforma"\cf5 \strokec5 , [\cf8 \strokec8 "spotify"\cf5 \strokec5 , \cf8 \strokec8 "instagram"\cf5 \strokec5 , \cf8 \strokec8 "youtube"\cf5 \strokec5 , \cf8 \strokec8 "tiktok"\cf5 \strokec5 ])\
    \
    history_df \cf7 \strokec7 =\cf5 \strokec5  get_platform_stats(platform_filter, days\cf7 \strokec7 =\cf9 \strokec9 90\cf5 \strokec5 )\
    \
    \cf3 \strokec3 if\cf5 \strokec5  \cf3 \strokec3 not\cf5 \strokec5  history_df.empty:\
        st.dataframe(history_df[[\cf8 \strokec8 'platform'\cf5 \strokec5 , \cf8 \strokec8 'metric_name'\cf5 \strokec5 , \cf8 \strokec8 'metric_value'\cf5 \strokec5 , \cf8 \strokec8 'date'\cf5 \strokec5 ]], use_container_width\cf7 \strokec7 =\cf9 \strokec9 True\cf5 \strokec5 )\
        \
        
\f4\i \cf6 \strokec6 # Grafico evoluzione
\f3\i0 \cf5 \strokec5 \
        \cf3 \strokec3 if\cf5 \strokec5  \cf8 \strokec8 len\cf5 \strokec5 (history_df) \cf7 \strokec7 >\cf5 \strokec5  \cf9 \strokec9 1\cf5 \strokec5 :\
            fig \cf7 \strokec7 =\cf5 \strokec5  px.line(history_df, x\cf7 \strokec7 =\cf8 \strokec8 'date'\cf5 \strokec5 , y\cf7 \strokec7 =\cf8 \strokec8 'metric_value'\cf5 \strokec5 , color\cf7 \strokec7 =\cf8 \strokec8 'metric_name'\cf5 \strokec5 ,\
                         title\cf7 \strokec7 =\cf8 \strokec8 f"Evoluzione Metriche \cf5 \strokec5 \{platform_filter.title()\}\cf8 \strokec8 "\cf5 \strokec5 ,\
                         template\cf7 \strokec7 =\cf8 \strokec8 "plotly_dark"\cf5 \strokec5 )\
            st.plotly_chart(fig, use_container_width\cf7 \strokec7 =\cf9 \strokec9 True\cf5 \strokec5 )\
    \cf3 \strokec3 else\cf5 \strokec5 :\
        st.info(\cf8 \strokec8 f"Nessun dato storico per \cf5 \strokec5 \{platform_filter\}\cf8 \strokec8 . Inizia recuperando le statistiche!"\cf5 \strokec5 )
\f0\fs24 \cf0 \cb1 \strokec2 \
}